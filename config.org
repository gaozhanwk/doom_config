# Title: Doom Emacs é…ç½®æ–‡ä»¶
#+title: Doom Emacs Configuration
#+subtitle: The Methods, Management, and Menagerie@@latex:\\@@ of Madness@@latex: --- in meticulous detail@@
#+date: @@html:<!--@@{{{git-rev}}}@@html:-->@@@@latex:\\\Large\bfseries@@ {{{modification-time(%Y-%m-%d, t)}}} @@latex:\\\normalsize\mdseries@@{{{modification-time(%H:%M, t)}}} @@latex:\acr{\lowercase{@@{{{timezone}}}@@latex:}}\iffalse@@, {{{git-rev}}}@@latex:\fi@@
#+macro: timezone (eval (substring (shell-command-to-string "date +%Z") 0 -1))
#+macro: git-rev (eval (format "@@html:<a href=\"https://github.com/GinShio/doom-private/commit/%1$s\" style=\"text-decoration: none\"><code style=\"padding: 0; color: var(--text-light); font-size: inherit; opacity: 0.7\">%1$s</code></a>@@@@latex:\\href{https://github.com/tecosaur/emacs-config/commit/%1$s}{\\normalsize\\texttt{%1$s}}@@" (substring (shell-command-to-string "git rev-parse --short HEAD") 0 -1)))
#+html_head: <link rel='shortcut icon' type='image/png' href='https://www.gnu.org/software/emacs/favicon.png'>
#+property: header-args:emacs-lisp :tangle yes :comments link
#+property: header-args:elisp :exports code
#+property: header-args :tangle "no" :results silent :eval no
#+options: coverpage:yes
#+startup: fold
#+latex_compiler: xelatex
#+latex_header: \usepackage{xeCJK}
#+latex_header: \setCJKmainfont{Source Han Serif SC}
#+latex_header: \setCJKsansfont{Source Han Sans SC}
#+latex_header: \setCJKmonofont{Source Han Mono SC}

#+begin_quote
è®©æˆ‘ä»¬æ”¹å˜å¯¹ç¨‹åºæ„å»ºçš„ä¼ ç»Ÿæ€åº¦ï¼š
ä¸å…¶æƒ³è±¡æˆ‘ä»¬çš„ä¸»è¦ä»»åŠ¡æ˜¯æŒ‡å¯¼è®¡ç®—æœºåšä»€ä¹ˆï¼Œ
ä¸å¦‚ä¸“æ³¨äºå‘äººä»¬è§£é‡Šæˆ‘ä»¬æƒ³è®©è®¡ç®—æœºåšä»€ä¹ˆã€‚
@@latex:\mbox{@@--- é«˜å¾·çº³@@latex:}@@
#+end_quote

* å¼•è¨€
ä¸å…¶è¯´ä¸å–œæ¬¢ IDEï¼Œå€’ä¸å¦‚è¯´ç°åœ¨å¤ªèœäº†ç”¨ä¸ä¸Š IDEï¼Œå†µä¸” Linux ä¸‹é™¤äº† JetBrains å®¶çš„
ä¹Ÿæ²¡å…¶ä»–èƒ½ç”¨çš„äº†ã€‚

ä¸è¿‡è¿™éƒ½æ˜¯åè¯äº†ï¼Œæœ€åˆç”¨çš„æ˜¯ =Dev-C++= å’Œ =VS 2017= ï¼Œè¯´å®è¯ VS å¥½çœ‹ä½†å¤ªå¤§äº†ï¼Œå¯¹
æˆ‘è¿™ç§å†™ /Hello World/ çš„äººæ¥è¯´å¤ªæµªè´¹äº†ã€‚å…¶å®ç®€å•è¯´å°±æ˜¯ï¼ŒVS å¤ªå¤§ä¸ä¼šç”¨ï¼ŒJetBrains
å¤ªè´µä¹°ä¸èµ·ï¼Œè™½ç„¶æ˜¯å­¦ç”Ÿå¯ä»¥ç”³è¯·å…è´¹å…¨å®¶æ¡¶ï¼Œä½† =CLion= ä¸åƒ /Intellij IDEA/ æˆ–è€…
/PyCharm/ å®ƒæ²¡å…è´¹ç‰ˆå•Šã€‚ä¹Ÿå°±å°è¯•ç€ =Notepad++= äº†ï¼Œå½“æ—¶å¹¶æ²¡ä»€ä¹ˆæ”¿æ²»å€¾å‘ã€‚ä¹Ÿå°±å½“ä¸€ä¸ª
è‡ªå¸¦é«˜äº®çš„è®°äº‹æœ¬ï¼Œ =Dev-C++= æ”¹ç”¨è¿˜å¾—ç”¨å•Šã€‚

åœ¨ç”¨ç¼–è¾‘å™¨æ—¶å¬é—»äº† =Vim= ã€ =Linux= ç­‰è½¯ä»¶ï¼Œçˆ·æŠ• ~*nix~ äº†ï¼æ‰€ä»¥ =Notepad++= ä¹Ÿ
ç”¨ä¸ä¸Šäº†ï¼Œé€‰æ¥é€‰å»é€‰äº†ä¸ª *Emacs* ï¼Œå¤šå°‘å¼€å§‹ç¦»è°±èµ·æ¥äº†ï¼Œå› ä¸ºæˆ‘è§‰å¾— Vim çš„ä¸”æ¨¡å¼å¥½éº»çƒ¦ã€‚
ä¸è¿‡å¥½åœ¨è¿™ç§ç©æ„ä¸€æ‹›é²œåƒéå¤©ï¼Œä½ å¯ä»¥ä¸ºå…¶æ·»åŠ ä»»æ„è¯­è¨€çš„æ”¯æŒï¼Œä»€ä¹ˆ /Intellij IDEA/ ã€
/PyCharm/ è¿˜è¦åˆ†ï¼Œå¤ªéº»çƒ¦äº†ï¼Œå°±é—®ä½ èƒ½åŠ  ~Erlang~ ã€ ~Elixir~ ã€ ~Haskell~ ç­‰æ”¯æŒ
å— (è¿™ä¸å·§äº†å—ï¼Œè¿˜éƒ½èƒ½åŠ )ã€‚å†µä¸”ç”¨ shell æ—¶é»˜è®¤çš„å¿«æ·é”®ä¹Ÿæ˜¯å’Œ Emacs ä¸€è‡´çš„ã€‚

æ€ä¹ˆä¸ç”¨ Vimï¼Œå› ä¸ºæˆ‘ä¸å–œæ¬¢åˆ‡æ¢æ¨¡å¼å•Šã€‚æ‰€ä»¥æˆ‘ç°åœ¨ä¹Ÿä¸ç”¨ =evil= æˆ– [[https://github.com/meow-edit/meow][meow]] ï¼Œä¸è¿‡å¾ˆæ¨è
å°è¯•ä¸€ä¸‹ meowã€‚æ€ä¹ˆä¸ç”¨ =VSCode= ï¼Œå…¶å®å½“æ—¶ä¹Ÿæ²¡ä»€ä¹ˆ VSCodeï¼Œ =Atom= ç”¨ä¸ç”¨å•Šï¼Œ
=Sublime= ç”¨ä¸ç”¨å•Šã€‚é‚£å½“ç„¶æ˜¯ä¸ç”¨å•Šï¼Œä¸æƒ³å†è¦ä¸€ä¸ª Chromium å•Šï¼Œä¹Ÿä¸æƒ³ä¹°æˆæƒã€‚hhhh

è‡³äº Lisp ä¼šä¸ä¼šå•Šï¼Œé‚£è‚¯å®šä¹Ÿæ˜¯ä¸ä¼šçš„å•Šï¼Œå°±åªå­¦ä¼šäº† =New Jersey style= å’Œ
=The MIT approach= ä¸¤ä¸ªåè¯ï¼Œå¹²ä»€ä¹ˆç”¨ï¼Œå¯ä»¥è£… B å¯ä»¥å˜²è®½ä½ è¯´æœ‰ç”¨å—ã€‚

** Why Emacs
ç½‘ä¸Šå¯¹äº Emacs çš„æ¨èçš„æ–‡ç« å¾ˆå¤šï¼Œæˆ‘å°±ä¸è¯´äº†ï¼Œæˆ‘å°±ä¸€èœé¸¡ã€‚

è¿™é‡Œçœ‹çœ‹ [[github:tecosaur][@tecosaur]] å¯¹äºå‡ ä¸ªç¼–è¾‘å™¨çš„æ¯”è¾ƒ

#+plot: transpose:yes type:radar min:0 max:4 ticks:4 file:"misc/editor-comparison.svg"
| Editor      | Extensibility | Ecosystem | Ease of Use | Comfort | Completion | Performance |
|-------------+---------------+-----------+-------------+---------+------------+-------------|
| IDLE        |             1 |         1 |           3 |       1 |          1 |           2 |
| VSCode      |             3 |         3 |           4 |     3.5 |          4 |           3 |
| Brackets    |           2.5 |         2 |           3 |       3 |        2.5 |           2 |
| Emacs       |             4 |         4 |           2 |       4 |        3.5 |           3 |
| Komodo Edit |             2 |         1 |           3 |       2 |          2 |           2 |

#+attr_html: :class invertible :alt Radar chart comparing my thoughts on a few editors.
#+attr_latex: :options inkscapelatex=false
[[file:misc/editor-comparison.svg]]

è¿™ç§è¡¨æœ‰å¾ˆå¼ºçš„ä¸»è§‚å°è±¡ï¼Œä¸è¿‡å¯¹äºç¼–è¾‘å™¨ï¼Œè¿˜æ˜¯æ¨è VSCodeã€Emacs å’Œ Vimã€‚
æˆ‘åªæ˜¯å–œæ¬¢ç¼–è¾‘å™¨åœ¨ç¼–è¾‘æ–¹é¢æå¼ºçš„æ‰©å±•ä¼˜åŠ¿ï¼Œå¯¹äº Everything (æ¯”å¦‚ mu4e, EAF)ï¼Œ
æˆ‘çš„å…´è¶£å¹¶ä¸é«˜ï¼Œæˆ–è®¸å› ä¸ºå®ƒä»¬åˆéº»çƒ¦åˆæ²¡æœ‰ FF / Thunderbird å¥½ç”¨ï¼Ÿ

æœ€åè¿˜æ˜¯è¦è¯´ä¸€ä¸‹ï¼ŒEmacs çš„ä¼˜åŠ¿ï¼Œ
+ é€’å½’ç¼–è¾‘
+ æ™®éçš„æ–‡æ¡£å­—ç¬¦ä¸²ï¼Œä»¥åŠå®Œå…¨çš„å†…çœæ€§
+ åœ¨å¯å˜ç¯å¢ƒä¸­çš„å¢—é‡ä¿®æ”¹
+ æ— éœ€ç‰¹å®šåº”ç”¨å¯ç”¨åŠŸèƒ½
+ å…è®¸å®¢æˆ·ç«¯ã€æœåŠ¡å™¨åˆ†ç¦»ï¼Œå¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ï¼Œæä¾›å‡ ä¹æ— æ„ŸçŸ¥çš„å¯åŠ¨æ—¶é—´

å°¤å…¶æ˜¯ *Org-mode* ï¼Œå…¨çƒç‹¬æ­¤ä¸€å®¶ï¼

** Issues

+ Emacs æœ‰ä¸€äº›ä»¤äººåŒçƒ¦çš„å¥‡æ€ªæ“ä½œ
+ æŸäº›æ–¹é¢å¾ˆæš´éœ²å¹´é¾„ (åç§°çº¦å®šã€API ç­‰)
+ Emacs [[https://www.gnu.org/software/emacs/manual/html_node/elisp/Threads.html][å‡ ä¹]] æ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™æ„å‘³ç€ä¸€äº›ä¸å½“çš„æ“ä½œå°†é˜»å¡æ•´ä¸ªåº”ç”¨
+ ä¸€äº›å…¶ä»–æ–¹é¢çš„å¹²æ‰°â€¦â€¦

è¯´å®è¯ï¼Œæˆ‘æ˜¯ä¸ª Emacs ã€Œä½æ‰‹ã€ï¼Œå¹¶ä¸æ˜¯é«˜æ‰‹ã€‚æ‰€ä»¥ ELisp æœ‰ç‚¹ç—›è‹¦ï¼Œä¸è¿‡è¿˜å¥½å§ï¼Œèµ·ç 
ä¼šç®— src_elisp{(+ 1 1)}ã€‚

* åŸºç¡€é…ç½®
åˆ›å»ºè¯æ³•ç»‘å®šå¯ä»¥ (ç¨å¾®) åŠ é€Ÿé…ç½®æ–‡ä»¶çš„è¿è¡Œã€‚ (æ›´å¤šå†…å®¹å¯ä»¥æŸ¥çœ‹ [[https://nullprogram.com/blog/2016/12/22/][è¿™ç¯‡åšå®¢]])
#+begin_src emacs-lisp :comments no
;;; config.el -*- lexical-binding: t; -*-
#+end_src

#+begin_src shell :exports none :comments no :tangle-mode (identity #o755) :tangle no
#!/usr/bin/env bash
source /etc/os-release
#+end_src

é…ç½®æœ‰ç”¨ä¸”åŸºç¡€çš„ä¸ªäººä¿¡æ¯
#+begin_src emacs-lisp
(setq user-full-name "gaozhan"
      user-mail-address "gaozhan@seirobotics.net"
      org-directory "/mnt/d/JGcloud/Nutstore/org"
      )
#+end_src
æ˜¾ç„¶è¿™å¯ä»¥è¢« GPG æˆ–å…¶ä»–ç¨‹åºä½¿ç”¨ã€‚

** è®¾ç½®é»˜è®¤å€¼
å°è¯•ä¸€ä¸‹åˆ«äººçš„é»˜è®¤å€¼ï¼Œæ¯”å¦‚ [[https://github.com/angrybacon/dotemacs/blob/master/dotemacs.org#use-better-defaults][angrybacon/dotemacs]]
#+begin_src emacs-lisp
;;(add-hook! 'window-setup-hook #'toggle-frame-fullscreen)
(display-time-mode t)   ;å¼€å¯æ—¶é—´çŠ¶æ€æ 

(define-key! global-map "C-s" #'+default/search-buffer)
(map! (:leader (:desc "load a saved workspace" :g "wr" #'+workspace/load))) ;; workspace load keybind

(when IS-WINDOWS
  (setq-default buffer-file-coding-system 'utf-8-unix)
  (set-default-coding-systems 'utf-8-unix)
  (prefer-coding-system 'utf-8-unix))
                                    ; å°† Windows ä¸Šçš„ç¼–ç æ”¹ä¸º UTF-8 Unix æ¢è¡Œ

(custom-set-variables '(delete-selection-mode t) ;; delete when you select region and modify
                      '(delete-by-moving-to-trash t) ;; delete && move to transh
                      '(inhibit-compacting-font-caches t) ;; donâ€™t compact font caches during GC.
                      '(gc-cons-percentage 1))

(add-hook 'prog-mode-hook (lambda () (setq show-trailing-whitespace 1)))
                                    ; ç¼–ç¨‹æ¨¡å¼ä¸‹è®©ç»“å°¾çš„ç©ºç™½ç¬¦äº®èµ·
#+end_src

å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„ key leaderï¼Œæˆ–è®¸æ²¡ä»€ä¹ˆç”¨
#+begin_src emacs-lisp
(after! general
  (general-create-definer ginshio/leader :prefix "s-y"))
#+end_src

é»˜è®¤æƒ…å†µä¸‹é€šè¿‡è‡ªå®šä¹‰ç•Œé¢æ‰€åšçš„ä¿®æ”¹ä¼šè¢«æ·»åŠ åˆ° =init.el= ä¸­ã€‚
ä¸è¿‡æ­£å¸¸çš„æ–¹æ³•æ˜¯å°†å®ƒä»¬æ”¾åœ¨ =.custom.el= ä¸­ã€‚
#+begin_src emacs-lisp
(setq-default custom-file (expand-file-name ".custom.el" doom-private-dir))
(when (file-exists-p custom-file) (load custom-file))
#+end_src

è®¾ç½®ä¸€ä¸ªæ–¹ä¾¿çš„åœ¨ window ä¹‹é—´è¿›è¡Œåˆ‡æ¢çš„å¿«æ·é”®ã€‚
#+begin_src emacs-lisp :tangle no
(map! :map ctl-x-map
      "<left>"   #'windmove-left
      "<down>"   #'windmove-down
      "<up>"     #'windmove-up
      "<right>"  #'windmove-right
      )
#+end_src

å¦‚æœæ˜¯ evil ç”¨æˆ·å¯ä»¥æ”¹ä¸ºä¸‹é¢è¿™ç§
#+begin_src emacs-lisp
(map! :map evil-window-map
      "SPC" #'rotate-layout
      ;; æ–¹å‘
      "<left>"   #'evil-window-left
      "<down>"   #'evil-window-down
      "<up>"     #'evil-window-up
      "<right>"  #'evil-window-right
      ;; äº¤æ¢çª—å£
      "C-<left>"   #'+evil/window-move-left
      "C-<down>"   #'+evil/window-move-down
      "C-<up>"     #'+evil/window-move-up
      "C-<right>"  #'+evil/window-move-right
      )
#+end_src

org æ–‡ä»¶åŠ è½½æ…¢
#+begin_src emacs-lisp
(setq org-modules-loaded t)
#+end_src

** Doom é…ç½®
æ‹‰å– doom-emacs ä»“åº“çš„åˆ†æ”¯
  - emacs-version: *28.1*
  - git commit: *986398504*
  - doom-version: *3.0.0-pre*
  - doom-modules-version: *v23.09.0-pre*
*** æ¨¡ç»„
:properties:
:header-args:emacs-lisp: :tangle no
:end:

#+name: init.el
#+attr_html: :collapsed t
#+begin_src emacs-lisp :tangle "init.el" :noweb no-export :comments no
;;; init.el -*- lexical-binding: t; -*-

;; This file controls what Doom modules are enabled and what order they load
;; in. Remember to run 'doom sync' after modifying it!

;; NOTE Press 'SPC h d h' (or 'C-h d h' for non-vim users) to access Doom's
;;      documentation. There you'll find a link to Doom's Module Index where all
;;      of our modules are listed, including what flags they support.

;; NOTE Move your cursor over a module's name (or its flags) and press 'K' (or
;;      'C-c c k' for non-vim users) to view its documentation. This works on
;;      flags as well (those symbols that start with a plus).
;;
;;      Alternatively, press 'gd' (or 'C-c c d') on a module to browse its
;;      directory (for easy access to its source code).

(doom! :input
       <<doom-input>>

       :completion
       <<doom-completion>>

       :ui
       <<doom-ui>>

       :editor
       <<doom-editor>>

       :emacs
       <<doom-emacs>>

       :term
       <<doom-term>>

       :checkers
       <<doom-checkers>>

       :tools
       <<doom-tools>>

       :os
       <<doom-os>>

       :lang
       <<doom-lang>>

       :email
       <<doom-email>>

       :app
       <<doom-app>>

       :config
       <<doom-config>>
       )
#+end_src

**** ç»“æ„
è¿™æ˜¯ä¸€ç¯‡æ–‡å­¦ç¼–ç¨‹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ Doom Emacs çš„é…ç½®æ–‡ä»¶ã€‚Doom å¯¹å…¶æ”¯æŒè‰¯å¥½ï¼Œæ›´å¤šè¯¦æƒ…
å¯ä»¥é€šè¿‡ ~literate~ (æ–‡å­¦) æ¨¡å—äº†è§£ã€‚

#+name: doom-config
#+begin_src emacs-lisp
literate
(default +bindings +smartparens)
#+end_src

**** æ¥å£
å¯ä»¥åšå¾ˆå¤šäº‹æ¥å¢å¼º Emacs çš„åŠŸèƒ½ï¼Œã€‚

- è¾“å…¥ ::
  ä¸­æ—¥æ–‡è¾“å…¥ä¸é”®ç›˜å¸ƒå±€
  #+name: doom-input
  #+begin_src emacs-lisp
;;bidi              ; (tfel ot) thgir etirw uoy gnipleh
;;chinese
;;japanese
;;layout            ; auie,ctsrnm is the superior home row
  #+end_src

- è¡¥å…¨ ::
  æˆ–è®¸å«è¡¥å…¨æœ‰ç‚¹ä¸åˆé€‚ï¼Œä¸è¿‡ä¹Ÿå°±è¿™æ ·äº†ã€‚å¦å¤–è¯´ä¸€ä¸‹ï¼Œ ~helm~ ã€ ~ido~ ã€ ~ivy~ ä»¥
  åŠ ~vertico~ æ˜¯åŠŸèƒ½ä¸€è‡´çš„ï¼Œç”Ÿæ€ä¸åŒçš„å››ä¸ªåŒ…
  #+name: doom-completion
  #+begin_src emacs-lisp
(company            ; the ultimate code completion backend
  +childframe)
;;helm              ; the *other* search engine for love and life
;;ido               ; the other *other* search engine...
;;(ivy              ; a search engine for love and life
;; +icons           ; ... icons are nice
;; +prescient)      ; ... I know what I want(ed)
(vertico +icons)    ; the search engine of the future
  #+end_src

- UI :: å¥½ä¸å¥½çœ‹å°±çœ‹ä½ è¿™ä¹ˆé…ç½®äº†
  #+name: doom-ui
  #+begin_src emacs-lisp
;;deft              ; notational velocity for Emacs
doom                ; what makes DOOM look the way it does
doom-dashboard      ; a nifty splash screen for Emacs
doom-quit           ; DOOM quit-message prompts when you quit Emacs
(emoji +unicode)    ; ğŸ™‚
hl-todo             ; highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW
;;hydra
;;indent-guides     ; highlighted indent columns
;;(ligatures +extra)  ; ligatures and symbols to make your code pretty again
;;minimap           ; show a map of the code on the side
modeline            ; snazzy, Atom-inspired modeline, plus API
nav-flash           ; blink cursor line after big motions
;;neotree           ; a project drawer, like NERDTree for vim
ophints             ; highlight the region an operation acts on
;;(popup            ; tame sudden yet inevitable temporary windows
;; +all             ; catch all popups that start with an asterix
;; +defaults)       ; default popup rules
tabs                ; a tab bar for Emacs
treemacs            ; a project drawer, like neotree but cooler
;;unicode           ; extended unicode support for various languages
(vc-gutter +pretty) ; vcs diff in the fringe
vi-tilde-fringe     ; fringe tildes to mark beyond EOB
(window-select      ; visually switch windows
 +numbers)
workspaces          ; tab emulation, persistence & separate workspaces
;; zen              ; distraction-free coding or writing
  #+end_src

- ç¼–è¾‘å™¨ :: *VI VI VI Editor of the Beast*
  #+name: doom-editor
  #+begin_src emacs-lisp
(evil +everywhere); come to the dark side, we have cookies
file-templates      ; auto-snippets for empty files
fold                ; (nigh) universal code folding
(format +onsave)    ; automated prettiness
;;god               ; run Emacs commands without modifier keys
;;lispy             ; vim for lisp, for people who don't like vim
multiple-cursors    ; editing in many places at once
;;objed             ; text object editing for the innocent
;;parinfer          ; turn lisp into python, sort of
rotate-text         ; cycle region at point between text candidates
snippets            ; my elves. They type so I don't have to
;;word-wrap         ; soft wrapping with language-aware indent
  #+end_src

- Emacs :: å¢å¼ºä¸€ä¸‹å§ï¼Œä¸ç„¶çœŸçš„æ˜¯ç¬”è®°æœ¬äº† (å…¶å®ä¸æ˜¯
  #+name: doom-emacs
  #+begin_src emacs-lisp
(dired +icons)      ; making dired pretty [functional]
electric            ; smarter, keyword-based electric-indent
(ibuffer +icons)    ; interactive buffer management
undo                ; persistent, smarter undo for your inevitable mistakes
vc                  ; version-control and Emacs, sitting in a tree
  #+end_src

- ç»ˆç«¯ :: ä¹Ÿè®¸æˆ‘åº”è¯¥å¸è½½æ‰æˆ‘çš„ ~Konsole~
  #+name: doom-term
  #+begin_src emacs-lisp
eshell            ; the elisp shell that works everywhere
;;shell             ; simple shell REPL for Emacs
;;term              ; basic terminal emulator for Emacs
vterm               ; the best terminal emulation in Emacs
  #+end_src

- æ£€æµ‹ :: å¯ä»¥å‘Šè¯‰æˆ‘å“ªé‡Œä¸å¯¹ï¼Œä½†æˆ‘è§‰å¾—æˆ‘åº”è¯¥å…ˆå¥½å¥½èƒŒèƒŒå•è¯æˆ–è€…çœ‹çœ‹ PEP8
  #+name: doom-checkers
  #+begin_src emacs-lisp
;;syntax              ; tasing you for every semicolon you forget
;;(:if (or (executable-find "hunspell")
;;         (executable-find "aspell")) spell) ; tasing you for misspelling mispelling
;;grammar           ; tasing grammar mistake every you make
  #+end_src

- å·¥å…· :: Workflow in Emacs!
  #+name: doom-tools
  #+begin_src emacs-lisp
ansible
;;biblio              ; Writes a PhD for you (citation needed)
(debugger +lsp)     ; FIXME stepping through code, to help you add bugs
;;direnv
;;docker
editorconfig        ; let someone else argue about tabs vs spaces
;;ein               ; tame Jupyter notebooks with emacs
(eval +overlay)     ; run code, run (also, repls)
;;gist              ; interacting with github gists
(lookup             ; helps you navigate your code and documentation
 +dictionary        ; dictionary/thesaurus is nice
 +docsets)          ; ...or in Dash docsets locally
(lsp +peek)         ; M-x vscode
(magit              ; a git porcelain for Emacs
 +forge)            ; interface with git forges
make                ; run make tasks from Emacs
;;pass              ; password manager for nerds
pdf                 ; pdf enhancements
;;prodigy           ; FIXME managing external services & code builders
rgb                 ; creating color strings
;;taskrunner        ; taskrunner for all your projects
;;terraform         ; infrastructure as code
;;tmux              ; an API for interacting with tmux
;;tree-sitter       ; syntax and parsing, sitting in a tree...
;;upload            ; map local to remote projects via ssh/ftp
  #+end_src

- OS :: æœ‰ä¸ªé—®é¢˜ï¼Œæˆ‘ä¼šç”¨ MAC å—
  #+name: doom-os
  #+begin_src emacs-lisp
(:if IS-MAC macos)  ; improve compatibility with macOS
tty                 ; improve the terminal Emacs experience
  #+end_src

**** ç¼–ç¨‹è¯­è¨€æ”¯æŒ
æœ€çˆ½çš„äº‹æƒ…å°±æ˜¯ï¼Œæˆ‘å¯ä»¥åœ¨ Emacs ä¸­ç¼–å†™ä»»ä½•è¯­è¨€ (çš„ =Hello World=)

#+name: doom-lang
#+begin_src emacs-lisp
;;agda              ; types of types of types of types...
;;beancount         ; mind the GAAP
(cc +lsp)           ; C > C++ == 1
;;clojure           ; java with a lisp
common-lisp       ; if you've seen one lisp, you've seen them all
;;coq               ; proofs-as-programs
;;crystal           ; ruby at the speed of c
;;csharp            ; unity, .NET, and mono shenanigans
;;data                ; config/data formats
;;(dart +flutter)   ; paint ui and not much else
;;dhall
;;(elixir +lsp)       ; erlang done right
;;elm               ; care for a cup of TEA?
emacs-lisp          ; drown in parentheses
;;(erlang +lsp)       ; an elegant language for a more civilized age
;;ess               ; emacs speaks statistics
;;factor
;;faust             ; dsp, but you get to keep your soul
;;fortran           ; in FORTRAN, GOD is REAL (unless declared INTEGER)
;;fsharp            ; ML stands for Microsoft's Language
;;fstar             ; (dependent) types and (monadic) effects and Z3
;;gdscript          ; the language you waited for
;;(go +lsp)         ; the hipster dialect
;;(graphql +lsp)    ; Give queries a REST
;;(haskell +lsp)    ; a language that's lazier than I am
;;hy                ; readability of scheme w/ speed of python
;;idris             ; a language you can depend on
json                ; At least it ain't XML
(java +lsp)       ; the poster child for carpal tunnel syndrome
;;(javascript +lsp) ; all(hope(abandon(ye(who(enter(here))))))
;;julia             ; a better, faster MATLAB
;;kotlin            ; a better, slicker Java(Script)
;(latex              ; writing papers in Emacs has never been so fun
; +latexmk           ; what else would you use?
; +cdlatex           ; quick maths symbols
; +fold)             ; fold the clutter away nicities
;;lean              ; for folks with too much to prove
;;ledger            ; be audit you can be
;;lua                 ; one-based indices? one-based indices
markdown            ; writing docs for people to ignore
;;nim               ; python + lisp at the speed of c
;;nix               ; I hereby declare "nix geht mehr!"
;;ocaml             ; an objective camel
(org                ; organize your plain life in plain text
 +pretty            ; yessss my pretties! (nice unicode symbols)
 +dragndrop         ; drag & drop files/images into org buffers
 +hugo              ; use Emacs for hugo blogging
 ;;+noter           ; enhanced PDF notetaking
 ;;+jupyter         ; ipython/jupyter support for babel
 +pandoc            ; export-with-pandoc support
 +gnuplot           ; who doesn't like pretty pictures
 ;;+pomodoro        ; be fruitful with the tomato technique
 +present           ; using org-mode for presentations
 +roam2          ; wander around notes
 )
;;php               ; perl's insecure younger brother
;;plantuml          ; diagrams for confusing people more
;;purescript        ; javascript, but functional
python              ; beautiful is better than ugly
;;qt                ; the 'cutest' gui framework ever
;;racket            ; a DSL for DSLs
;;raku              ; the artist formerly known as perl6
;;rest              ; Emacs as a REST client
;;rst               ; ReST in peace
;;(ruby +rails)     ; 1.step {|i| p "Ruby is #{i.even? ? 'love' : 'life'}"}
;;(rust +lsp)       ; Fe2O3.unwrap().unwrap().unwrap().unwrap()
;;scala             ; java, but good
(scheme +guile)     ; a fully conniving family of lisps
sh                  ; she sells {ba,z,fi}sh shells on the C xor
;;sml
;;solidity          ; do you need a blockchain? No.
;;swift             ; who asked for emoji variables?
;;terra             ; Earth and Moon in alignment for performance.
;;web               ; the tubes
;;yaml                ; JSON, but readable
;;zig               ; C, but simpler
#+end_src

**** Everything in Emacs
*leave* Emacs

- é‚®ä»¶ :: è¯´å®è¯ï¼Œæˆ‘æƒ³ç”¨ =Thunderbird=
  #+name: doom-email
  #+begin_src emacs-lisp
;;(mu4e +org +gmail)
;;notmuch
;;(wanderlust +gmail)
  #+end_src

- åº”ç”¨ :: å¯ä»¥åœ¨ Emacs ä¸­ä¸Šç½‘çœ‹æ–°é—»ã€‚æˆ–è®¸æˆ‘å¯ä»¥ç”¨ irc èŠå¤©
  #+name: doom-app
  #+begin_src emacs-lisp
;;calendar
;;emms
everywhere          ; *leave* Emacs!? You must be joking
;;irc               ; how neckbeards socialize
;;(rss +org)        ; emacs as an RSS reader
;;twitter           ; twitter client https://twitter.com/vnought
  #+end_src

*** è§†è§‰è®¾ç½®
**** å­—ä½“è®¾ç½®
'Source Code Pro' å’Œ 'Fira Code' çš„æ•ˆæœéƒ½å¾ˆä¸é”™ï¼Œ'JetBrains Mono' å’Œ 'IBM Plex Mono'
æˆ–è®¸ä¹Ÿä¸é”™ã€‚è¿˜æ˜¯æ¯”è¾ƒæ¨è Mono å­—ä½“ï¼Œç­‰å®½çœ‹ä»£ç èˆ’æœã€‚

Unicode å­—ä½“ä¸ºä»€ä¹ˆä¸è¯•è¯• 'JuliaMono' å‘¢ï¼Ÿ

#+begin_src emacs-lisp
;; TODO
#+end_src

ä¸è¿‡è¿™éƒ½æ˜¯è¥¿æ–‡å­—ä½“ï¼Œæ²¡æœ‰è€ƒè™‘è¿‡ CJK ç”¨æˆ·çš„æ„Ÿå—å—ï¼ï¼åœ¨åé¢çš„
[[æ‚é¡¹][æ‚é¡¹]] ä¸­ï¼Œå°†è¯¦ç»†è¯´ä¸€ä¸‹ CJK å­—ä½“çš„é…ç½®ã€‚

é™¤äº†è¿™äº›å­—ä½“å¤–ï¼Œå­—ä½“ [[https://github.com/SorkinType/Merriweather/][Merriweather]] è¿˜è¢«ç”¨äº =nov.el= ä¸­ï¼Œå­—ä½“ [[https://github.com/huertatipografica/Alegreya][Alegreya]] ä½œä¸ºè¡¬çº¿æ¯”
ä¾‹å­—ä½“è¢«ç”¨äº Org æ–‡ä»¶çš„ =writeroom-mode= ä¸­çš„ =mixed-pitch-mode= ã€‚

**** ä¸»é¢˜å’Œ modeline
~doom-one~ æ˜¯ Doom è‡ªå¸¦çš„å¤§è€Œå…¨çš„ä¸»é¢˜ï¼Œé‡Œé¢å®åœ¨å¤ªå¤šå¥½çœ‹çš„ä¸»é¢˜äº†ï¼Œå¹²å˜›è¿˜è¦è‡ªå·±æ‰¾ã€‚
è¿™é‡Œæˆ‘æƒ³åœ¨ä¼—å¤šæˆ‘å–œæ¬¢çš„ä¸»é¢˜ä¸­ï¼Œå¯åŠ¨æ—¶éšæœºé€‰å–ä¸€æ¬¾ã€‚
#+begin_src emacs-lisp :tangle no
(setq doom-theme (let ((themes '(doom-vibrant
                                 doom-fairy-floss
                                 doom-dracula
                                 doom-Iosvkem
                                 doom-moonlight
                                 doom-monokai-pro
                                 doom-tokyo-night)))
                   (elt themes (random (length themes)))))
#+end_src

å½“ç„¶ä½ ä¸å–œæ¬¢è¿™æ ·ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šä¸€æ¬¾ã€‚
#+begin_src emacs-lisp
(setq doom-theme 'doom-vibrant)
#+end_src

è®¾ç½®ä¸€ä¸‹ modelineï¼Œæ¯”å¦‚è¯´å›¾æ ‡ã€æ–‡ä»¶åç§°ä»¥åŠå½©è™¹çŒ« (Nyan cat)ï¼
#+begin_src emacs-lisp
(after! doom-modeline
  (custom-set-variables '(doom-modeline-buffer-file-name-style 'relative-to-project)
                        '(doom-modeline-major-mode-icon t)
                        '(doom-modeline-modal-icon nil))
  (nyan-mode t))
#+end_src

**** æ‚é¡¹
ç›¸å¯¹è¡Œå·å¯ä»¥å¾ˆå¥½çš„çŸ¥é“è·ç¦»ç›®æ ‡è¡Œæœ‰å¤šè¿œï¼Œç„¶åç”¨å¿«æ·é”® =C-u num <UP>= æˆ–
=ESC num <UP>= åˆ°è¾¾ä½ æƒ³å»çš„è¡Œã€‚
#+begin_src emacs-lisp
;;(setq display-line-numbers-type 'relative)
(setq display-line-numbers-type t)
#+end_src

æˆ‘æƒ³è®¾ç½®ä¸€ä¸‹æ›´å¥½çœ‹çš„é»˜è®¤ç¼“å†²åŒºåç§°
#+begin_src emacs-lisp
(setq doom-fallback-buffer-name "â–º Doom"
      +doom-dashboard-name "â–º Doom")
#+end_src

å†æ¥è¯´è¯´åˆå§‹åŒ– doom æ—¶ï¼ŒUI ä¸Šå…¶å®è¿˜æœ‰å¾ˆå¤šèƒ½åšçš„ï¼Œæ¯”å¦‚è¯´å…³é—­ä¸‘çš„ä¸è¡Œçš„ ~menu-bar~ ï¼Œ
è®¾ç½®å…‰æ ‡æ¨¡å¼ï¼Œä»¥åŠ CJK å­—ä½“ç­‰ã€‚

*** è¾…åŠ©å®
è¿™äº›æ˜¯ doom æ·»åŠ çš„ä¸€äº›éå¸¸æœ‰ç”¨çš„å®
- ~load!~ å¯ä»¥ç›¸å¯¹äºæœ¬æ–‡ä»¶è¿›è¡Œå¤–éƒ¨ ~.el~ æ–‡ä»¶çš„åŠ è½½
- ~use-package!~ ç”¨äºé…ç½®åŒ…
- ~add-load-path!~ å°†æŒ‡å®šç›®å½•æ·»åŠ åˆ° ~load-path~ ä¸­ï¼Œå¯ä»¥è®© Emacs åœ¨ä½¿ç”¨
  ~require~ å’Œ ~use-package~ æ—¶åœ¨ ~load-path~ ä¸­è¿›è¡ŒæŸ¥æ‰¾
- ~map!~ ç”¨äºç»‘å®šæ–°çš„å¿«æ·é”®

*** å…è®¸ CLI è¿è¡Œ org-babel ç¨‹åº
åœ¨ Org ä¸­æœ‰æ—¶ä¼šå†™ä¸€ç‚¹ä»£ç ï¼Œ[[https://orgmode.org/worg/org-contrib/babel][Org-Babel]] å°±æ˜¯å„ä¸ªè¯­è¨€åœ¨ Org-mode ä¸­çš„å·´åˆ«å¡”ã€‚å¤§å®¶éƒ½
å¯ä»¥é€šè¿‡å®ƒæ¥ç›´æ¥è¿è¡Œã€‚

ä½†æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¹Ÿä¼šæœ‰ä¸€äº›ä»£ç ï¼Œå¦‚æœåœ¨ CLI ä¸­æ‰§è¡Œ =doom sync= ä¹‹ç±»çš„æ“ä½œï¼Œå¤§é‡çš„
ä»£ç å—è¾“å‡ºä¼šç›´æ¥æ±¡æŸ“è¾“å‡ºã€‚è¿™ä¸èƒ½å¿ï¼

å¥½åœ¨ DOOM æä¾›äº†æ¯æ¬¡è¿è¡Œ CLI å‰è¯»å– =$DOOMDIR/cli.el= çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å†æ‰‹åŠ¨
ç¡®è®¤æ˜¯å¦è¿è¡ŒæŸä¸ªä»£ç å— (~org-confirm-babel-evaluate~)ï¼Œå¹¶ä¸”ç”¨
~org-babel-execute-src-block~ æ¥æ²‰é»˜è¿™äº›ä»£ç å—ï¼Œé¿å…æ±¡æŸ“è¾“å‡ºã€‚

#+begin_src emacs-lisp :tangle cli.el :comments no
;;; cli.el -*- lexical-binding: t; -*-
(setq! org-confirm-babel-evaluate nil)
(advice-add 'org-babel-execute-src-block
            :around #'(lambda (orig-fn &rest args)
                        (quiet! (apply orig-fn args))))
#+end_src

** å…¶ä»–è®¾ç½®
*** çª—å£æ ‡é¢˜
æˆ‘æ›´å–œæ¬¢çª—å£å±•ç¤ºç¼“å†²åŒºçš„åå­—ï¼Œç„¶åæ˜¯é¡¹ç›®æ–‡ä»¶å¤¹ (å¦‚æœå¯ç”¨)ã€‚
#+begin_src emacs-lisp
(setq! frame-title-format
      '("%b â€“ Doom Emacs"
        (:eval
         (let ((project-name (projectile-project-name)))
           (unless (string= "-" project-name)
             (format "  -  [%s]" project-name))))))
#+end_src

*** å¯åŠ¨ç•Œé¢
[[github:tecosaur][tecosaur]] åšäº†ä¸€ä¸ªç›¸å½“æ£’çš„å¯åŠ¨ç”»é¢ï¼Œå¿ƒåŠ¨ï¼ä½†æ˜¯å¤ªå¤æ‚äº†ã€‚æˆ‘åªæ˜¯æƒ³ç®€å•çš„åœ¨æ¯æ¬¡é‡å¯æ—¶
æ›´æ¢ bannerï¼Œä»…æ­¤è€Œå·²ã€‚

*** å®ˆæŠ¤è¿›ç¨‹
å®ˆæŠ¤è¿›ç¨‹æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå¯æƒœæˆ‘ç”¨çš„æ˜¯ WSLï¼Œæ²¡æœ‰ =systemd= ï¼Œä¸è¿‡ [[https://www.emacswiki.org/emacs/EmacsAsDaemon][EmacsWiki]] ä¸­è¿˜æ˜¯åˆ—å‡ºäº†
å„ç§ Daemon çš„æ–¹æ³•
*** WSL
**** æˆªå›¾
#+begin_src emacs-lisp
(defun my-yank-image-from-win-clipboard-through-powershell()
  "to simplify the logic, use c:/Users/Public as temporary directoy, and move it into current directoy"
  (interactive)
  (let* ((powershell "/mnt/c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe")
         (file-name (format-time-string "screenshot_%Y%m%d_%H%M%S.png"))
         ;; (file-path-powershell (concat "c:/Users/\$env:USERNAME/" file-name))
         (file-path-wsl (concat "./images/" file-name))
         )
    ;; (shell-command (concat powershell " -command \"(Get-Clipboard -Format Image).Save(\\\"C:/Users/\\$env:USERNAME/" file-name "\\\")\""))
    (shell-command (concat powershell " -command \"(Get-Clipboard -Format Image).Save(\\\"C:/Users/Public/" file-name "\\\")\""))
    (rename-file (concat "/mnt/c/Users/Public/" file-name) file-path-wsl)
    (insert (concat "[[file:" file-path-wsl "]]"))
    (message "insert DONE.")
    ))

(global-set-key (kbd "<f12>") 'my-yank-image-from-win-clipboard-through-powershell)
#+end_src
**** æµè§ˆå™¨
#+begin_src emacs-lisp
;; wslè°ƒç”¨windowæµè§ˆå™¨
(defun my/browse-url-generic (url &optional _new-window)
  ;; new-window ignored
  "Ask the WWW browser defined by `browse-url-generic-program' to load URL.
Default to the URL around or before point.  A fresh copy of the
browser is started up in a new process with possible additional arguments
`browse-url-generic-args'.  This is appropriate for browsers which
don't offer a form of remote control."
  (interactive (browse-url-interactive-arg "URL: "))
  (if (not browse-url-generic-program)
      (error "No browser defined (`browse-url-generic-program')"))
  (apply 'call-process browse-url-generic-program nil
	 0 nil
	 (append browse-url-generic-args
                 (list (format "start %s"
                               (replace-regexp-in-string "&" "^&" url))))))

(when (and (eq system-type 'gnu/linux)
           (string-match
            "Linux.*Microsoft.*Linux"
            (shell-command-to-string "uname -a")))
  (setq
   browse-url-generic-program  "/mnt/c/Windows/System32/cmd.exe"
   browse-url-generic-args     '("/c")
   browse-url-browser-function #'my/browse-url-generic))

#+end_src
*** rg && find
#+begin_src emacs-lisp
;; è®¾ç½® ripgrep å‘½ä»¤
;; æ‰“å¼€æ–‡ä»¶åé»˜è®¤å¯ç¼–è¾‘
(setq-default buffer-read-only nil)
(setq grep-command "rg -u --no-heading -n ")
#+end_src

* åŒ…
** åŠ è½½ç»“æ„
:properties:
:header-args:emacs-lisp: :tangle no
:end:

doom é€šè¿‡ =packages.el= æ¥å®‰è£…åŒ…ï¼Œéå¸¸ç®€å•ï¼Œåªéœ€è¦ ~package!~ å°±å¯ä»¥å®‰è£…ã€‚
éœ€è¦æ³¨æ„ï¼Œä¸åº”è¯¥å°†è¯¥æ–‡ä»¶ç¼–è¯‘ä¸ºå­—èŠ‚ç ã€‚
#+begin_src emacs-lisp :tangle "packages.el" :comments no
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/packages.el
#+end_src

*è­¦å‘Š*: ä¸è¦ç¦ç”¨ =~/.emacs.d/core/packages.el= ä¸­åˆ—å‡ºçš„åŒ…ã€‚Doom ä¾èµ–è¿™äº›ï¼Œç¦ç”¨å®ƒä»¬
å¯èƒ½å‡ºç°ä¸¥é‡é—®é¢˜ã€‚

- ä»å®˜æ–¹çš„æº [[https://melpa.org/][MELPA]] / [[http://elpa.gnu.org/][GNU ELPA]] / [[https://emacsmirror.net/][emacsmirror]] å®‰è£…
  #+begin_src emacs-lisp
(package! some-package)
  #+end_src
- å…³é—­æŸäº›åŒ…
  #+begin_src emacs-lisp
(package! some-package :disable t)
  #+end_src
- ä» Git Repo å®‰è£…
  #+begin_src emacs-lisp
;; github
(package! github-package :recipe (:host github :repo "username/repo"))
;; gitlab
(package! gitlab-package :recipe (:host gitlab :repo "username/repo"))
;; other
(package! other-package :recipe (:host nil :repo "https://example.com/repo"))
  #+end_src
  å¦‚æœ repo ä»…ä¸­åªæœ‰æŸä¸ª / æŸäº›æ–‡ä»¶æ˜¯ä½ éœ€è¦çš„
  #+begin_src emacs-lisp
(package! some-package
  :recipe (:host github :repo "username/repo"
           :files ("some-file.el" "src/elisp/*.el")))
  #+end_src
  å¦‚æœéœ€è¦æŒ‡å®šæŸä¸ª =commit= æˆ–æŸä¸ª =branch=
  #+begin_src emacs-lisp
;; commit
(package! some-package :pin "abcdefghijk")
;; branch
(package! some-package :recipe (:branch "stable"))
  #+end_src
- ä½¿ç”¨æœ¬åœ°çš„ repo
  #+begin_src emacs-lisp
(package! some-package :recipe (:local-repo "/path/to/repo"))
  #+end_src

** å·¥å…·
*** Input
**** Spell Check
~Ispell~ æ˜¯ä¸€ä¸ªå¤è€çš„ Unix æ‹¼å†™æ£€æŸ¥è½¯ä»¶ï¼Œå½“ç„¶ä½ å¯ä»¥å°†å…¶å½“ä½œæ‹¼å†™æ£€æŸ¥è½¯ä»¶çš„ä¸€ç§ä»£ç§°ã€‚
#+begin_src emacs-lisp
(set-company-backend!
  '(text-mode
    markdown-mode
    gfm-mode)
  '(:seperate
    company-ispell
    company-files
    company-yasnippet))
#+end_src

Hunspell è¿˜æ˜¯ Aspell éƒ½å¬ä¸é”™ï¼Œä½†æ˜¯ Aspell æ¯”è¾ƒå¼å¾®ï¼Œæ•…æœ¬é…ç½®ä½¿ç”¨çš„æ˜¯å‰è€…ï¼Œ
ä½†æ˜¯ä¹‹åçš„é…ç½®æ˜¯ä¸€æ ·çš„

Hunspell å’Œ Aspell éƒ½å¯ä»¥ä»  [[http://app.aspell.net/create][SCOWL Custom List / Dicionary Creator]]
è·å–ä¸€ä¸ªå¥½ç”¨çš„å¤§è¯å…¸
- size (å¤§å°) :: 95 (ç–¯ç‹‚)
- spellings (æ‹¼å†™) :: è‹±è¯­ (ç¾å›½) å’Œ è‹±è¯­ (è‹±å›½, -ise)
- spelling variants level (æ‹¼å†™å˜ä½“ç­‰çº§) :: 0
- diacritics (å˜éŸ³ç¬¦å·) :: ä¿ç•™
- extra lists (é¢å¤–åˆ—è¡¨) :: hackerã€ç½—é©¬æ•°å­—

å¦‚æœä½ ç”¨çš„æ˜¯ Linux ä¸”ä¸æƒ³è‡ªå·±ä¸‹è½½äº†ï¼Œå¯ä»¥ç”¨ç”¨ä¸‹é¢è¿™ä¸ªå°è„šæœ¬ (hunspell ä¸ç”¨)
  - Hunspell
#+begin_src shell :tangle no
cd /tmp
wget -O "hunspell-en-custom.zip" \
    -c 'http://app.aspell.net/create?max_size=95&spelling=US&spelling=GBs&max_variant=0&diacritic=keep&special=hacker&special=roman-numerals&encoding=utf-8&format=tar.gz&download=hunspell'
unzip "hunspell-en-custom.zip"
sudo chown root:root en-custom.*
sudo mkdir -p /usr/share/hunspell/
sudo mv en-custom.{aff,dic} /usr/share/hunspell/
sudo ln -s /usr/share/hunspell/en-custom.aff /usr/share/hunspell/en_US.aff
sudo ln -s /usr/share/hunspell/en-custom.dic /usr/share/hunspell/en_US.dic
#+end_src
  - Aspell
#+begin_src shell :tangle no
cd /tmp
wget -O "aspell6-en-custom.tar.bz2" \
    -c 'http://app.aspell.net/create?max_size=95&spelling=US&spelling=GBs&max_variant=0&diacritic=keep&special=hacker&special=roman-numerals&encoding=utf-8&format=tar.gz&download=aspell'
tar -xjf "aspell6-en-custom.tar.bz2"
cd aspell6-en-custom
./configure && make && sudo make install
#+end_src

é…ç½®ä¸€ä¸‹å°±èƒ½å¼€å§‹ç”¨äº†
#+begin_src emacs-lisp :tangle no
(setq! ispell-dictionary "en-custom")
#+end_src

**** iedit å¤šè¡Œç¼–è¾‘å·¥å…·
iedit æ˜¯å¤šè¡ŒåŒæ—¶ç¼–è¾‘å·¥å…·ï¼Œå½“ç„¶ lsp ä¹Ÿå¯èƒ½éœ€è¦å®ƒ (å¦‚æœä½ è¦å¤šè¡ŒåŒæ—¶ä¿®æ”¹ä»£
ç çš„è¯)ã€‚

#+begin_src emacs-lisp :tangle packages.el
(package! iedit :recipe (:host github :repo "victorhge/iedit"))
#+end_src

#+begin_src emacs-lisp
(use-package! iedit :defer t)
#+end_src

*** hungry delete
ä¸€æ¬¡ ~backspace~ åƒæ‰æ‰€æœ‰ç©ºç™½ç¬¦ (å½“å‰å…‰æ ‡é™å®š)
#+begin_src emacs-lisp :tangle packages.el
(package! hungry-delete :recipe (:host github :repo "nflath/hungry-delete"))
#+end_src

#+begin_src emacs-lisp
(use-package! hungry-delete
  :config
  (setq-default hungry-delete-chars-to-skip " \t\v")
  (add-hook! 'after-init-hook #'global-hungry-delete-mode))
#+end_src

*** Magit
:properties:
:header-args:emacs-lisp: :tangle no :noweb-ref magit-tweaks
:end:
#+begin_comment
æ¥è‡ª =:tools magit= æ¨¡å—
#+end_comment

è¿™åº”è¯¥æ˜¯ Emacs çš„æ€æ‰‹åº”ç”¨ä¹‹ä¸€äº†ï¼Œæ„Ÿè°¢ [[https://github.com/tarsius][Jonas]] åŠå…¶ä»–è´¡çŒ®è€…ã€‚

#+begin_src emacs-lisp
(after! magit
  <<magit-tweaks>>)
#+end_src

**** æäº¤æ¨¡æ¿
ç°åœ¨å¹¶æ²¡æœ‰å®Œæˆè¿™éƒ¨åˆ†ï¼Œå¤„äºä¸€ç§å®Œå…¨ä¸ä¼šå†™æäº¤çš„çŠ¶æ€ï¼Œä»¥åå¤§æ¦‚ç‡ä¼šå¢åŠ ä¸€ä¸ªæäº¤æ¨¡æ¿ã€‚

**** Delta
[[https://github.com/dandavison/delta/][Delta]] æ˜¯ç”¨ rust å®ç°çš„ git diff è¯­æ³•é«˜äº®çš„å·¥å…·ã€‚è¯¥ä½œè€…è¿˜å°†å…¶æŒ‚æ¥åˆ°äº† magit çš„
diff è§†å›¾ä¸Š (é»˜è®¤ä¸ä¼šæœ‰è¯­æ³•é«˜äº®)ã€‚ä¸è¿‡è¿™éœ€è¦ =delta= äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåœ¨ cargo å®‰è£…
æ˜¾å¾—ç®€å•äº›ï¼Œä¸è¿‡ä½ ä¹Ÿå¯ä»¥é€‰æ‹© [[https://github.com/dandavison/delta/releases/latest][GitHub Release]]ã€‚

#+begin_src shell :tangle no
cargo install git-delta
#+end_src

ç®€å•åœ°é…ç½®å®ƒå°±è¡Œ
#+begin_src emacs-lisp :tangle packages.el
(package! magit-delta :recipe (:host github :repo "dandavison/magit-delta"))
#+end_src

#+begin_src emacs-lisp
(use-package! magit-delta
  :after magit
  :hook (magit-mode . magit-delta-mode))
#+end_src

*** Completion
æ²¡æœ‰è¡¥å…¨æ€ä¹ˆå†™ä»£ç ï¼Œå°¤å…¶æ˜¯ =Java=â€‹ï¼ï¼ï¼
#+begin_src emacs-lisp
(after! company
  (setq! company-idle-delay 0.3
         company-minimum-prefix-length 2
         company-show-numbers t)
  ) ;; make aborting less annoying.
#+end_src

ç°åœ¨æ”¹è¿›å¤§å¤šæ¥è‡ª ~å…ˆå‰é€‰é¡¹~ çš„å†å²è®°å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¹è¿›ä»¥ä¸‹å†å²è®°å½•ã€‚
#+begin_src emacs-lisp
(setq-default history-length 1024
              prescient-history-length 1024)
#+end_src

è¿˜æœ‰æœ€è¦ç´§çš„äº‹ï¼Œè®©å¾…é€‰é€‰é¡¹æœ‰æ•°å­—æç¤ºï¼Œæ–¹ä¾¿ç›´æ¥ ~Alt+num~ é€‰æ‹©
#+begin_src emacs-lisp
(custom-set-variables '(company-show-numbers t))
#+end_src

*** Vertico
+ Consult
+ Marginalia

*** LSP
è‡ªä» lsp æ™®åŠå¼€å§‹ï¼Œæ— è®ºé…ç½®ä»€ä¹ˆç¼–è¾‘å™¨éƒ½ä¸å†å¤æ‚äº†ã€‚çœ‹äº†ä¸€åœˆ
[[https://emacs-lsp.github.io/lsp-mode/tutorials/][lsp-mode tutorial]] ç”šè‡³è§‰å¾—ä¸éœ€è¦é…ç½®ä»€ä¹ˆï¼Œä¼°è®¡ doom ä¹Ÿæœ‰ç›¸åº”çš„é…ç½®ã€‚é—®é¢˜å°±æ˜¯ï¼Œç†Ÿ
æ‚‰é…ç½®ã€æ“ä½œçš„é—®é¢˜ã€‚

#+begin_src emacs-lisp
(after! lsp-ui
  (setq lsp-ui-sideline-enable t
        lsp-ui-sideline-show-diagnostics t
        lsp-ui-sideline-show-hover nil
        lsp-ui-sideline-show-code-actions t
        lsp-ui-sideline-update-mode 'line

        lsp-ui-peek-enable t
        lsp-ui-peek-always-show t

        lsp-ui-doc-enable t
        lsp-ui-doc-use-childframe t
        lsp-ui-doc-position 'at-point
        lsp-ui-doc-delay 0.5
        ))
#+end_src

*** TRAMP
å…³äºå…¶ä»–å¾ˆæœ‰ç”¨çš„åŠŸèƒ½ï¼ŒTRAMP ç®—ä¸€ä¸ªï¼Œå®ƒæ˜¯å¤šåè®®é€æ˜è¿œç¨‹è®¿é—® (/Transparent Remote
Access, Multiple Protocol/) å·¥å…·ã€‚ç®€å•è¯´è¿™æ˜¯ç®€å•è®¿é—®å…¶ä»–ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„æ–¹æ³•ã€‚

å¦‚æœä½ æƒ³ä½¿ç”¨ =ssh-key= ï¼Œå»ºè®®å¼€å§‹ä½¿ç”¨ ~ssh config~ ï¼Œå¹¶ç”¨ ~sshx:~ è¿›è¡Œ tramp è¿æ¥ã€‚

**** æç¤ºåŒºåŸŸ
ä¸å¹¸çš„æ˜¯ï¼ŒTRAMP å¯¹è¿œç¨‹è¿æ¥æ—¶ SHELL çš„æç¤ºæ ¼å¼å¾ˆæŒ‘å‰”ï¼Œå°è¯•ä½¿ç”¨ bash å¹¶æ”¾å®½æ¾æç¤º
åŒºåŸŸçš„è¯†åˆ«ã€‚

#+begin_src emacs-lisp
(after! tramp
  (setenv "SHELL" "/bin/bash")
  (setq tramp-auto-save-directory "~/tmp/tramp/")
  (setq tramp-chunksize 2000)
  (setq tramp-shell-prompt-pattern
        "\\(?:^\\|
\\)[^]#$%>\n]*#?[]#$%>î‚°] *\\(\\[[0-9;]*[a-zA-Z] *\\)*"))  ;; default + î‚°
#+end_src

**** Guix
[[https://guix.gnu.org/][Guix]] å°†ä¸€äº› TRAMP éœ€è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾ç½®åœ¨äº†æ„æƒ³ä¸åˆ°çš„ä½ç½®ã€‚è¿™ä¸æ˜¯ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥
æ‰‹åŠ¨å¸®åŠ© TRAMP æ‰¾åˆ°å®ƒä»¬ã€‚
#+begin_src emacs-lisp
(after! tramp
  (appendq! tramp-remote-path
            '("~/.guix-profile/bin" "~/.guix-profile/sbin"
              "/run/current-system/profile/bin"
              "/run/current-system/profile/sbin")))
#+end_src

*** YASnippet
#+begin_comment
æ¥è‡ª =:editor snippets= æ¨¡å—
#+end_comment

snippets å¥—å¨ƒè°ç”¨è°çŸ¥é“ï¼
#+begin_src emacs-lisp
(setq yas-triggers-in-field t)
#+end_src

*** Screenshot
#+begin_notes
screenshot ä¾èµ–äº [[https://imagemagick.org/index.php][ImageMagick]]
#+end_notes

è®©æˆªå›¾å˜å¾—è½»è€Œæ˜“ä¸¾ï¼
#+begin_src emacs-lisp :tangle packages.el
(package! screenshot
  :recipe (:host github :repo "tecosaur/screenshot" :build (:not compile))
  )
#+end_src

#+begin_src emacs-lisp
(use-package! screenshot :defer t)
#+end_src

[[https://github.com/tecosaur/screenshot][åŸé¡¹ç›®]]æš‚æ—¶è¿˜æ²¡æœ‰ä¿®å¤ BUGï¼Œå¹¶ä¸”ä½œè€…å¹¶æ²¡æœ‰æ‰“ç®—æ·»åŠ  TUI æ”¯æŒã€‚

*** rime
#+begin_src emacs-lisp :tangle packages.el
(package! rime)
(package! posframe)
#+end_src

#+begin_src emacs-lisp
(use-package! rime
  :config
  (setq rime-user-data-dir "~/.config/fcitx/rime")
  (setq rime-posframe-properties
      (list :background-color "#333333"
            :foreground-color "#dcdccc"
            :font "SimSun"
            :internal-border-width 10))
  (setq default-input-method "rime"
      rime-show-candidate 'posframe)
  (setq rime-translate-keybindings
        '("C-f" "C-b" "C-n" "C-p" "C-g" "<left>" "<right>" "<up>" "<down>" "<prior>" "<next>" "<delete>"))
  :bind
  (:map rime-mode-map
        ("C-`" . 'rime-send-keybinding))
  )
#+end_src

*** counsel
#+begin_src emacs-lisp :tangle packages.el
(package! counsel :disable t)
#+end_src
*** denote
#+begin_src emacs-lisp :tangle packages.el
(package! denote)
#+end_src

#+begin_src emacs-lisp
(use-package denote
  :bind
  ;(("C-c n n" . denote)
   ;("C-c n i" . denote-link-or-create)
   ;("C-c n I" . denote-link)
   ;("C-c n b" . denote-link-backlinks)
   ;("C-c n a" . denote-add-front-matter)
   ;("C-c n r" . denote-rename-file)
   ;("C-c n R" . denote-rename-file-using-front-matter)
   ;)
)

(setq denote-directory (expand-file-name "/mnt/d/JGcloud/Nutstore/org")
      denote-infer-keywords t
      denote-sort-keywords t
      denote-allow-multi-word-keywords t
      denote-date-prompt-use-org-read-date t
      denote-link-fontify-backlinks t
      denote-front-matter-date-format 'org-timestamp
      denote-prompts '(title keywords))
#+end_src
*** org-roam
roam2 å®‰è£…æ”¾åœ¨init.elä¸­äº†
#+begin_src emacs-lisp :tangle no
(package! org-roam
  :recipe (:host github :repo "org-roam/org-roam" :branch "v2"))
#+end_src

#+begin_src emacs-lisp
(use-package! org-roam
  :after org
  :commands
  (org-roam-buffer
   org-roam-setup
   org-roam-capture
   org-roam-node-find)
  :config
  (setq org-roam-directory "/mnt/d/JGcloud/Nutstore/org/")
  ;;(setq org-roam-mode-sections
  ;;      (list #'org-roam-backlinks-insert-section
  ;;            #'org-roam-reflinks-insert-section
  ;;            #'org-roam-unlinked-references-insert-section))
  (org-roam-setup))
#+end_src

**** ä¸ºä»¥å‰éorg-roam åˆ›å»ºçš„ç¬”è®°åˆ›å»ºå¤´éƒ¨ID
#+begin_src emacs-lisp
(defun my/add-id-each-org-file-in-dir ()
  " ä¸ºç¬”è®°ç›®å½•ä¸‹çš„æ‰€æœ‰org æ–‡ä»¶åŠ ä¸ŠID ä»¥ä¾¿ roam ç´¢å¼•"
  (interactive)
  (let* ((roam-dir (expand-file-name "/mnt/d/JGcloud/Nutstore/org/"))
         all-org-files
         file-content)
    ;; (message "roam-dir : %s" roam-dir)
    (setq all-org-files (directory-files-recursively roam-dir (rx ".org" eos)))
    (dolist (each-file all-org-files)
      ;; (dolist (each-file (cl-subseq all-org-files 1 4))
      ;; (message "each-file : %s" each-file)
      (setq file-content (f-read-text each-file))
      ;; è·³è¿‡org ä¸­çš„å¤´éƒ¨çš„æ³¨é‡Š  æŠ„è‡ª org-roam-strip-comments
      (setq file-content  (with-temp-buffer
                            (insert file-content)
                            (goto-char (point-min))
                            (while (not (eobp))
                              (if (org-at-comment-p)
                                  (delete-region (point-at-bol) (progn (forward-line) (point)))
                                (forward-line)))
                            (buffer-string)))

      ;; åˆ¤æ–­æ˜¯å¦æœ‰ID å¤´ å¦‚æœæ²¡æœ‰å°±åˆ›å»º
      ;; :PROPERTIES:
      ;; :ID:       6ad2b2ed-6961-4db9-852d-06523d0a5c43
      ;; :END:
      (unless (or (string-match "\*.*\n:PROPERTIES:\n:ID:.*\n:END:" (s-left 400 file-content)) (string-match ":PROPERTIES:\n:ID:.*\n:END:" (s-left 200 file-content)))   ;; string-match ä¸åŒ¹é…æ¢è¡Œç¬¦ ä¸€å®šè¦åŠ ä¸Šæ¢è¡Œç¬¦æ‰è¡Œ
        (message "%s insert ID" each-file)
        (find-file each-file)
        (goto-char (point-min))
        (org-id-store-link)
        (save-buffer)
        (kill-buffer)))))
#+end_src
** UI
*** Nyan
é¦–å…ˆæ·»åŠ ä¸€ä¸‹å½©è™¹çŒ«ï¼Œè¿™ä¸èƒ½å¿˜ï¼
#+begin_src emacs-lisp :tangle "packages.el"
(package! nyan-mode :recipe (:host github :repo "TeMPOraL/nyan-mode"))
#+end_src

#+begin_src emacs-lisp
(use-package! nyan-mode
  :config
  (setq nyan-animate-nyancat t
        nyan-wavy-trail t
        nyan-cat-face-number 4
        nyan-bar-length 16
        nyan-minimum-window-width 64)
  (add-hook! 'doom-modeline-hook #'nyan-mode))
#+end_src

*** Eros
#+begin_comment
æ¥è‡ª =:tools eval= æ¨¡å—
#+end_comment

è¿™ä¸ªåŒ…å¯ä»¥ä¿®æ”¹ emacs lisp å†…è”æ‰§è¡Œçš„è§†è§‰æ•ˆæœï¼Œè®©è¿™ä¸ªç»“æœçš„å‰ç¼€æ›´å¥½çœ‹ä¸€ç‚¹ã€‚
#+begin_src emacs-lisp
(setq eros-eval-result-prefix "âŸ¹ ") ; default =>
#+end_src

ä½ å¯ä»¥ç”¨ =C-x C-e= æ¥å¯¹æ¯”ä¸€ä¸‹å‰åå˜åŒ–
#+begin_src emacs-lisp :tangle no :results vaule replace
(+ 1 1 (* 2 2) 1)
#+end_src

#+RESULTS:
: 7

#+begin_src python :tangle no :results vaule replace
return 2 ** 4
#+end_src

#+RESULTS:
: 16

*** Theme Magic
éå¸¸ç¥å¥‡çš„æ˜¯ä½ å¯ä»¥åœ¨ Emacs ä¸­ç”¨ç°æœ‰çš„ Themeï¼Œæ”¹å˜ç»ˆç«¯çš„ Themeï¼Œä¸” GUI å’Œ TUI éƒ½
å¯ç”¨ï¼ä½œè€…è¯´ Linux å’Œ Mac å¯ç”¨ï¼Œ =Windows Terminal= + =WSL= åŒæ ·é€‚ç”¨ï¼Œå‹åŠ›æ¥åˆ°äº†
çº¯ Windows ä¸‹çš„ Emacsã€‚
#+begin_src emacs-lisp :tangle packages.el
(package! theme-magic :disable t)
#+end_src

è¿™ä¸ªæ“ä½œä½¿ç”¨ =pywal= ï¼Œä½ å¯ä»¥é€šè¿‡ä»“åº“å®‰è£…å®ƒï¼Œä¸è¿‡æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ =pip= ã€‚
#+begin_src shell :tangle no
sudo python3 -m pip install pywal
#+end_src

Theme Magic æä¾›äº†ä¸€ä¸ªæ•°å­—ç•Œé¢ï¼Œå°è¯•ä»é¥±å’Œåº¦ã€è‰²å½©å·®å¼‚æ¥æœ‰æ•ˆçš„é€‰å–å…«ä¸ªé¢œè‰²ã€‚ç„¶è€Œï¼Œå®ƒ
å¯èƒ½ä¼šä¸º light é€‰æ‹©ç›¸åŒçš„é¢œè‰²ï¼Œå¹¶ä¸æ€»èƒ½å¤Ÿé€‰å–æœ€ä½³é¢œè‰²ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ Doom themes
æä¾›çš„è‰²å½©å·¥å…·æ¥è½»æ¾è·å–åˆç†çš„é…è‰²æ¥ç”Ÿæˆ light ç‰ˆæœ¬ --- ç°åœ¨å°±å¼€å§‹ï¼

#+begin_src emacs-lisp :tangle no
(use-package! theme-magic
  :defer t
  :after +doom-dashboard
  :config
  (defadvice! theme-magic--auto-extract-16-doom-colors ()
    :override #'theme-magic--auto-extract-16-colors
    (list
     (face-attribute 'default :background)
     (doom-color 'error)
     (doom-color 'success)
     (doom-color 'type)
     (doom-color 'keywords)
     (doom-color 'constants)
     (doom-color 'functions)
     (face-attribute 'default :foreground)
     (face-attribute 'shadow :foreground)
     (doom-blend 'base8 'error 0.1)
     (doom-blend 'base8 'success 0.1)
     (doom-blend 'base8 'type 0.1)
     (doom-blend 'base8 'keywords 0.1)
     (doom-blend 'base8 'constants 0.1)
     (doom-blend 'base8 'functions 0.1)
     (face-attribute 'default :foreground))))
#+end_src

*** Emojify
#+begin_comment
æ¥è‡ª =:ui emoji= æ¨¡å—
#+end_comment

è®¾ç½®ä¸€ä¸ªä½ å–œæ¬¢çš„ emoji å­—ç¬¦é›†ï¼Œå½“ç„¶ä½ åªèƒ½ä»ä¸‰ä¸ªå­—ç¬¦é›†ä¸­åšé€‰æ‹©ï¼Œä½†ä½ å¯ä»¥é€‰æ‹©ä¸åŒ
ç‰ˆæœ¬
  + [[https://www.joypixels.com/][emojione]]
    * emojione-v2
    * emojione-v2-22
    * emojione-v2.2.6
    * emojione-v2.2.6-22
  + [[https://twemoji.twitter.com/][twemoji]]
    * twemoji-v2
    * twemoji-v2-22
  + [[https://openmoji.org/][openmoji]]
    * openmoji-v13-0

#+begin_src emacs-lisp :tangle no
(setq emojify-emoji-set "twemoji-v2")
#+end_src

OOTB çš„ emoji æ¨¡å—ï¼éº»çƒ¦çš„ä¸€ç‚¹æ˜¯è®¾ç½®çš„æœ‰äº›é»˜è®¤å­—ç¬¦ï¼Œå¯èƒ½ä¼šæ˜¾ç¤ºä¸º emojiã€‚
ç›´æ¥ä» emoji è¡¨ä¸­åˆ é™¤å®ƒä»¬ (é™¤äº†æœ‰ç‚¹æš´åŠ›)
#+begin_src emacs-lisp :tangle no
(defvar emojify-disabled-emojis
  '(;; Org
    "â—¼" "â˜‘" "â˜¸" "âš™" "â©" "âª" ":end:" "â†”"
    ;; Org Heading
    "âœ™" "â™±" "â™°" "â˜¥" "âœ" "âœŸ" "âœ" "â€ "
    "â˜°" "â˜±" "â˜²" "â˜³" "â˜´" "â˜µ" "â˜¶" "â˜·"
    "â˜¿" "â™€" "â™" "â™‚" "â™ƒ" "â™„" "â™…" "â™†" "â™‡" "â˜½" "â˜¾"
    "â™ˆ" "â™‰" "â™Š" "â™‹" "â™Œ" "â™" "â™" "â™" "â™" "â™‘" "â™’" "â™“"
    "â™”" "â™•" "â™–" "â™—" "â™˜" "â™™"
    "â™š" "â™›" "â™œ" "â™" "â™" "â™Ÿ"
    ;; Org Agenda
    "âš¡" "â†‘" "â†“" "â˜•" "â“"
    ;; I just want to see this as text
    "Â©" "â„¢")
  "Characters that should never be affected by `emojify-mode'.")

(defadvice! emojify-delete-from-data ()
  "Ensure `emojify-disabled-emojis' don't appear in `emojify-emojis'."
  :after #'emojify-set-emoji-data
  (dolist (emoji emojify-disabled-emojis)
    (remhash emoji emojify-emojis)))
#+end_src

*** Tabs
#+begin_comment
æ¥è‡ª =:ui tabs= æ¨¡å—
#+end_comment

å¦‚æœä½ æƒ³åƒç°ä»£ç¼–è¾‘å™¨ä¸€æ ·æ‹¥æœ‰ tabsï¼Œæˆ–è®¸ä½ å¯ä»¥è€ƒè™‘ä¸€ä¸‹ã€‚å¦‚æœæƒ³è¦ tabs åº•ä¸‹æ˜¾ç¤º
=bar=â€‹ï¼Œéœ€è¦å¼€å¯ ~x-underline-at-descent-line~
#+begin_src emacs-lisp
(after! centaur-tabs
  (setq! centaur-tabs-style "bar"
         centaur-tabs-set-icons t
         centaur-tabs-plain-icons nil
         centaur-tabs-set-modified-marker t
         centaur-tabs-show-navigation-buttons nil
         centaur-tabs-gray-out-icons 'buffer
         centaur-tabs-set-bar 'under
         x-underline-at-descent-line t
         centaur-tabs-label-fixed-length 9)
  (defun centaur-tabs-hide-tab (x)
    "Do no to show buffer X in tabs."
    (let ((name (format "%s" x)))
      (or
       ;; Current window is not dedicated window.
       (window-dedicated-p (selected-window))
       ;; Buffer name not match below blacklist.
       (string-prefix-p "*epc" name)
       (string-prefix-p "*helm" name)
       (string-prefix-p "*Helm" name)
       (string-prefix-p "*Compile-Log*" name)
       (string-prefix-p "*lsp" name)
       (string-prefix-p "*company" name)
       (string-prefix-p "*Flycheck" name)
       (string-prefix-p "*tramp" name)
       (string-prefix-p " *Mini" name)
       (string-prefix-p "*help" name)
       (string-prefix-p "*straight" name)
       (string-prefix-p " *temp" name)
       (string-prefix-p "*Help" name)
       (string-prefix-p "*mybuf" name)
       (string-prefix-p "â–º Doom" name)
       ;; Is not magit buffer.
       (and (string-prefix-p "magit" name)
            (not (file-name-extension name)))
       )))
  (centaur-tabs-group-by-projectile-project)
  (centaur-tabs-mode t))
#+end_src

ä½†æ˜¯åˆ«å¿˜äº†ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶[[æ¥å£]]ä¸­å¼€å¯ =tabs= é€‰é¡¹ã€‚è¿˜ä¸èƒ½å¿˜è®°æ·»åŠ å¿«æ·é”®
#+begin_src emacs-lisp
(map! :map ctl-x-map
      :prefix ("t" . "Tab and Treemacs")
      "a"   #'centaur-tabs-select-beg-tab
      "e"   #'centaur-tabs-select-end-tab
      "f"   #'centaur-tabs-forward-tab
      "F"   #'centaur-tabs-forward-group
      "b"   #'centaur-tabs-backward-tab
      "B"   #'centaur-tabs-backward-group
      "g"   #'centaur-tabs-switch-group
      "G"   #'centaur-tabs-toggle-groups
      "l"   #'centaur-tabs-move-current-tab-to-left
      "r"   #'centaur-tabs-move-current-tab-to-right
      "k"   #'centaur-tabs-kill-other-buffers-in-current-group
      "K"   #'centaur-tabs-kill-unmodified-buffers-in-current-group
      "C-5" #'centaur-tabs-extract-window-to-new-frame
      "C-o" #'centaur-tabs-open-in-external-application
      "C-d" #'centaur-tabs-open-directory-in-external-application
      )
#+end_src

*** Treemacs
#+begin_comment
æ¥è‡ª =:ui treemacs= æ¨¡å—
#+end_comment

å¼€å¯ =git-mode= ã€ =follow-mode= å’Œ =indent-guide-mode=â€‹ï¼Œä½“éªŒè¿˜æ˜¯ä¸é”™
#+begin_src emacs-lisp
(after! treemacs
  (setq! doom-themes-treemacs-theme               "doom-colors"
         treemacs-deferred-git-apply-delay        0.5
         treemacs-directory-name-transformer      #'identity
         treemacs-display-in-side-window          t
         treemacs-file-event-delay                1000
         treemacs-file-follow-delay               0.1
         treemacs-file-name-transformer           #'identity
         treemacs-hide-dot-git-directory          t
         treemacs-indent-guide-style              'block
         treemacs-show-hidden-files               t)
  (treemacs-indent-guide-mode t)
  (treemacs-follow-mode t)
  (treemacs-filewatch-mode t)
  (treemacs-fringe-indicator-mode 'always)
  (treemacs-git-mode 'deferred)
  (treemacs-hide-gitignored-files-mode t)
  )
#+end_src

å¯èƒ½æ˜¯æˆ‘çš„ç”¨æ³•ä¸å¯¹ï¼Ÿ =filewatch-mode= æ€»æ˜¯æœ‰é—®é¢˜ï¼Œåœ¨å¤–éƒ¨ä¿®æ”¹ (ä¸åœ¨ treemacs ä¸­
é‡å‘½åã€æ·»åŠ ã€åˆ é™¤ç­‰) å°±ä¼šæœ‰é—®é¢˜ï¼Œæ²¡æ³•æ›´æ–° treeã€‚éœ€è¦è‡ªå·±æ‰‹åŠ¨æŠ˜å ä¸€ä¸‹ã€‚

#+begin_src emacs-lisp
(map! :map ctl-x-map
      :prefix "t"
      "0"   #'treemacs-select-window
      "1"   #'treemacs-delete-other-windows
      "d"   #'treemacs-select-directory
      "C-e" #'treemacs-edit-workspaces
      "C-f" #'treemacs-find-file
      "C-t" #'treemacs-find-tag
      )
#+end_src

*** hl todo
~hl-todo~ å…è®¸ä½ è®¾ç½®ä¸€äº›å…³é”®å­—ï¼Œè¿™äº›å…³é”®å­—å°†é«˜äº®å¹¶ä¸”ä¾¿äºæŸ¥æ‰¾ã€‚å¾€å¾€ç”¨äºä»£ç æ³¨é‡Šä¸­
å¼ºè°ƒæŸäº›å†…å®¹ã€‚
#+begin_src emacs-lisp
(custom-set-variables
 '(hl-todo-keyword-faces '(("NOTE" font-lock-builtin-face bold) ;; needs discussion or further investigation.
                           ("REVIEW" font-lock-keyword-face bold) ;; review was conducted.
                           ("HACK" font-lock-variable-name-face bold) ;; workaround a known problem.
                           ("DEPRECATED" region bold) ;; why it was deprecated and to suggest an alternative.
                           ("XXX+" font-lock-constant-face bold) ;; warn other programmers of problematic or misguiding code.
                           ("TODO" font-lock-function-name-face bold) ;; tasks/features to be done.
                           ("FIXME" font-lock-warning-face bold) ;; problematic or ugly code needing refactoring or cleanup.
                           ("KLUDGE" font-lock-preprocessor-face bold )
                           ("BUG" error bold) ;; a known bug that should be corrected.
                           )))
#+end_src
*** cnfonts å­—ä½“
#+begin_src emacs-lisp :tangle packages.el
(package! cnfonts)
#+end_src

#+begin_src emacs-lisp :tangle config.el
(cnfonts-mode 1)
#+end_src

** æœ‰è¶£çš„ç”Ÿæ´»
*** å­—å…¸
æˆ‘ç”¨äº†å¾ˆä¹…ä¹Ÿä¸çŸ¥é“ doom æä¾›äº†å­—å…¸ï¼Œé‡‡ç”¨ =define-word= å’Œ [[https://github.com/gromnitsky/wordnut][wordnut]] æä¾›æœåŠ¡ï¼Œä¸è¿‡
ç¦»çº¿å­—å…¸å¯èƒ½æ›´ç¬¦åˆæœ¬åœ°çš„è¦æ±‚ã€‚

GoldenDict CLI åœ¨ GitHub ä¸Šæ˜¯ [[https://github.com/goldendict/goldendict/issues/37][ç›¸å½“å¥½è¯„çš„é—®é¢˜]]ï¼Œå¼€å‘è€…å·²ç»å°†å…¶åŠ å…¥ 1.5 çš„å¾…åšäº‹é¡¹ï¼Œ
ä½† 1.5 ä¾æ—§éš¾äº§ï¼Œä¹Ÿè®¸ä½ å¯ä»¥è€ƒè™‘è´¡çŒ®ä¸€ä¸‹ã€‚

æˆ‘çš„é…ç½®ä¹Ÿç­‰ GoldenDict å§ã€‚

* ç¼–ç¨‹è¯­è¨€é…ç½®
** çº¯æ–‡æœ¬
*** ANSI è‰²å½©
Emacs å¯ä»¥æ˜¾ç¤º ANSI é¢œè‰²ä»£ç ã€‚ç„¶è€Œï¼Œåœ¨ Emacs 28 ä¹‹å‰ï¼Œå¦‚æœä¸ä¿®æ”¹ç¼“å†²åŒºæ˜¯ä¸å¯èƒ½åšåˆ°è¿™
ä¸€ç‚¹çš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä»¥æ­¤ä¸ºåŸºç¡€è®¾ç½®è¿™ä¸ªå—ã€‚
#+begin_src emacs-lisp :tangle (if (>= emacs-major-version 28) "yes" "no")
(after! text-mode
  (add-hook! 'text-mode-hook
    (unless (derived-mode-p 'org-mode)
      ;; Apply ANSI color codes
      (with-silent-modifications
        (ansi-color-apply-on-region (point-min) (point-max) t)))))
#+end_src

*** æ— è¡Œå·è¾¹è·
æˆ‘ä¸ä»‹æ„å·¦ä¾§æ²¡æœ‰ä»»ä½•è¾¹è·çš„ bufferï¼Œä½†æ˜¯ä¸€æ—¦å‰¥ç¦»è¡Œå·ï¼Œbuffer å°±ä¼šæ„Ÿè§‰æœ‰ç‚¹ä¸å¯¹åŠ²ã€‚

#+begin_src emacs-lisp
(defvar +text-mode-left-margin-width 1
  "The `left-margin-width' to be used in `text-mode' buffers.")

(defun +setup-text-mode-left-margin ()
  (when (and (derived-mode-p 'text-mode)
             (eq (current-buffer) ; Check current buffer is active.
                 (window-buffer (frame-selected-window))))
    (setq left-margin-width (if display-line-numbers
                                0 +text-mode-left-margin-width))
    (set-window-buffer (get-buffer-window (current-buffer))
                       (current-buffer))))
#+end_src

ç°åœ¨æˆ‘ä»¬åªéœ€è¦å°†å®ƒè¿æ¥åˆ°æ‰€æœ‰å¯èƒ½è¡¨æ˜æ¡ä»¶å‘ç”Ÿå˜åŒ–æˆ–éœ€è¦é‡æ–°åº”ç”¨è®¾ç½®çš„äº‹ä»¶ã€‚

#+begin_src emacs-lisp
(add-hook 'window-configuration-change-hook #'+setup-text-mode-left-margin)
(add-hook 'display-line-numbers-mode-hook #'+setup-text-mode-left-margin)
(add-hook 'text-mode-hook #'+setup-text-mode-left-margin)
#+end_src

Doom æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œå› ä¸º ~doom/toggle-line-numbers~ ä¸è¿è¡Œ ~display-line-numbers-mode-hook~â€‹ï¼Œæ‰€ä»¥éœ€è¦ä¸€äº›è®¾ç½®ã€‚

#+begin_src emacs-lisp
(defadvice! +doom/toggle-line-numbers--call-hook-a ()
  :after #'doom/toggle-line-numbers
  (run-hooks 'display-line-numbers-mode-hook))
#+end_src

** Org Mode
:properties:
:CUSTOM_ID: org
:header-args:emacs-lisp: :tangle no :noweb-ref org-conf
:end:
:intro:
Org Mode æ— ç–‘æ˜¯ Emacs çš„æ€æ‰‹çº§åº”ç”¨ï¼Œå…¶æ‰©å±•èƒ½åŠ›ä»¥åŠ Emacs çš„å¥‘åˆï¼Œè®©å®ƒåŠæ‰“ä¸€ä¼—
æ ‡è®°è¯­è¨€å’Œå¯Œæ–‡æœ¬æ ¼å¼ã€‚å½“ç„¶ LaTeX é™¤å¤–ã€‚

#+attr_latex: :align *{8}{p{0.105\linewidth}} :font \small
#+plot: transpose:yes type:radar min:0 max:4 file:"misc/document-format-comparison.svg"
| æ ¼å¼               | ç»†ç²’åº¦æ§åˆ¶ | ä¸Šæ‰‹æ˜“ç”¨æ€§ | è¯­æ³•ç®€å• | ç¼–è¾‘å™¨æ”¯æŒ | é›†æˆåº¦ | æ˜“äºå‚è€ƒ | å¤šåŠŸèƒ½æ€§ |
|-------------------+-----------+-----------+---------+-----------+-------+---------+---------|
| Word              |         2 |         4 |       4 |         2 |     3 |       2 |       2 |
| LaTeX             |         4 |         1 |       1 |         3 |     2 |       4 |       3 |
| Org Mode          |         4 |         2 |     3.5 |         1 |     4 |       4 |       4 |
| Markdown          |         1 |         3 |       3 |         4 |     3 |       3 |       1 |
| Markdown + Pandoc |       2.5 |       2.5 |     2.5 |         3 |     3 |       3 |       2 |

é™¤äº†æ ‡è®°è¯­è¨€ (Markup Language) çš„ä¼˜é›…å¤–ï¼ŒEmacs é›†æˆäº†ä¸€åœºä¸°å¯Œçš„æœ‰è¶£çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´å¯¹
å½“å‰ä»»ä½•æŠ€æœ¯éƒ½æ”¯æŒçš„æ–‡å­¦ç¼–ç¨‹ã€‚
#+name: Literate programming workflow
#+attr_html: :style line-height:1.13;
#+begin_example
      â•­â”€â•´Codeâ•¶â”€â•®            â•­â”€â•´Raw Codeâ•¶â”€â–¶ Computer
Ideasâ•ºâ”¥        â”â”â–¶ Org Modeâ•ºâ”¥
      â•°â”€â•´Textâ•¶â”€â•¯            â•°â”€â•´Documentâ•¶â”€â–¶ People
#+end_example

åœ¨ =.org= æ–‡ä»¶å¯ä»¥åŒ…å«ä»£ç å— (ä¸æ”¯æŒ noweb æ¨¡æ¿)ï¼Œè¿™äº›ä»£ç å—å¯ä»¥ä¸ä¸“ç”¨æºä»£ç æ–‡ä»¶çº ç¼ 
åœ¨ä¸€èµ·ï¼Œå¹¶é€šè¿‡å„ç§ (å¯æ‰©å±•çš„) æ–¹æ³•ç¼–è¯‘æˆæ–‡æ¡£ (æŠ¥å‘Šã€æ–‡æ¡£ã€æ¼”ç¤ºæ–‡ç¨¿ç­‰)ã€‚è¿™äº›æºå—ç”šè‡³å¯ä»¥
åˆ›å»ºè¦åŒ…å«åœ¨æ–‡æ¡£ä¸­çš„å›¾åƒæˆ–å…¶ä»–å†…å®¹ï¼Œæˆ–è€…ç”Ÿæˆæºä»£ç ã€‚

#+name: Example Org Flowchart
#+attr_html: :style line-height:1.13;
#+begin_example
                   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .pdf â«
                  pdfLaTeX â–¶â•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•®                 âª
                   â•¿     â•¿                  â”Š                 âª
                   â”‚     â”Š                  â”Š                 âª
                 .tex    â”Š                  â”Š                 âª
                   â•¿     â”Š                  â”Š                 âª
                â•­â”€â”€â”´â•Œâ•Œâ•®  â”Š                  â”Š style.scss      â¬ Weaving
graphc.png â”€â•®   â”‚  embedded TeX             â”Š      â•½          âª (Documents)
image.jpeg â”€â”¤ filters   â•¿                   â”Š    .css         âª
            â•     â•¿     â”Š                   â”Š     â–¾â•          âª
figure.pngâ•¶â”€â•§â”€â–¶ PROJECT.ORG â–¶â”€â”€â”€â•´filtersâ•¶â”€â”€â”€â•§â”€â”€â”€â”€â”€â”€â•ªâ”€â”€â–¶ .html âª
     â•¿           â•¿â”Š â•‘ â”‚ â•°â•Œâ•Œâ•Œâ–·â•Œâ•Œ embedded html â–¶â•Œâ•Œâ•Œâ•Œâ•¯          âª
     â”œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ–·â•Œâ•Œâ•Œâ•¯â”Š â•‘ â”‚                                       âª
    resultâ•¶â•Œâ•Œâ•Œâ•Œâ•Œâ•® â”Š â•‘ â”œâ”€â”€â”€â”€â”€â”€â•´filtersâ•¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .txt  âª
     â”Šâ–´         â”Š â”Š â•‘ â”‚                                       âª
    execution   â”Š â”Š â•‘ â•°â”€â”€â”€â”€â”€â”€â•´filtersâ•¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .md   â­
     â”Šâ–´         â”Š â”Š â•‘
    code blocksâ—€â•¯ â”Š â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .c    â«
     â•°â•Œâ•Œâ•Œâ•Œâ—â•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•¯ â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .sh   â¬ Tangling
                    â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .hs   âª (Code)
                    â•™â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .el   â­
#+end_example
:end:

å› ä¸ºè¿™éƒ¨åˆ†åˆå§‹åŒ–æ—¶ç›¸å½“è´¹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ”¾åœ¨ src_elisp{(after! ...)} ä¸­ã€‚
#+begin_src emacs-lisp :noweb no-export :tangle yes :noweb-prefix no :noweb-ref nil
(after! org
  <<org-conf>>)
#+end_src

*** ç³»ç»Ÿè®¾ç½®
**** Mime ç±»å‹
é»˜è®¤æƒ…å†µä¸‹ï¼ŒOrg æ¨¡å¼ä¸ä¼šè¢«è¯†åˆ«ä¸ºå®ƒè‡ªå·±çš„ MIME ç±»å‹ï¼Œä½†å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–‡ä»¶è½»æ¾æ›´æ”¹ã€‚ å¯¹äºç³»ç»ŸèŒƒå›´çš„æ›´æ”¹ï¼Œè¯·å°è¯• ~/usr/share/mime/packages/org.xml~ ã€‚
#+begin_src xml :tangle ~/.local/share/mime/packages/org.xml :mkdirp yes :comments no
<mime-info xmlns='http://www.freedesktop.org/standards/shared-mime-info'>
  <mime-type type="text/org">
    <comment>Emacs Org-mode File</comment>
    <glob pattern="*.org"/>
    <alias type="text/org"/>
  </mime-type>
</mime-info>
#+end_src

[[https://github.com/PapirusDevelopmentTeam/papirus-icon-theme/commit/a10fb7f2423d5e30b9c4477416ccdc93c4f3849d][Papirus]] æœ‰ä¸€ä¸ª =text/org= çš„å›¾æ ‡ï¼Œåªéœ€åˆ·æ–° mime æ•°æ®åº“ã€‚
#+begin_src shell :tangle no
update-mime-database ~/.local/share/mime
#+end_src

ç°åœ¨è®¾ç½® emacs ä¸ºé»˜è®¤çš„ç¼–è¾‘å™¨ã€‚
#+begin_src shell :tangle no
xdg-mime default emacs.desktop text/org
#+end_src
**** Git diffs
Protesilaos å†™äº†ä¸€ç¯‡ [[https://protesilaos.com/codelog/2021-01-26-git-diff-hunk-elisp-org/][éå¸¸æœ‰ç”¨çš„æ–‡ç« ]]ï¼Œä»–åœ¨å…¶ä¸­è§£é‡Šäº†å¦‚ä½•å°† git diff å—æ ‡é¢˜æ›´æ”¹ä¸º
æ¯”å¤§å—ä¸Šæ–¹çš„ç›´æ¥è¡Œæ›´æœ‰ç”¨çš„ä¸œè¥¿ --- å°±åƒçˆ¶æ ‡é¢˜ä¸€æ ·ã€‚

è¿™å¯ä»¥é€šè¿‡é¦–å…ˆåœ¨ =~/.config/git/attributes= ä¸­ä¸º git æ·»åŠ æ–°çš„å·®å¼‚æ¨¡å¼æ¥å®ç°ã€‚
#+begin_example
,*.org   diff=org
#+end_example


ç„¶åä¸ºå®ƒæ·»åŠ ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åˆ° =~/.config/git/config= ã€‚
#+begin_example
[diff "org"]
  xfuncname = "^(\\*+ +.*)$"
#+end_example

*** åŠŸèƒ½å¢å¼º
**** åŸºç¡€åŠŸèƒ½

#+begin_src emacs-lisp
(setq! org-use-property-inheritance t         ; it's convenient to have properties inherited
       org-log-done 'time                     ; having the time a item is done sounds convenient
       org-list-allow-alphabetical t          ; have a. A. a) A) list bullets
       ;; org-export-in-background t             ; run export processes in external emacs process
       org-catch-invisible-edits 'smart       ; try not to accidently do weird stuff in invisible regions
       org-export-with-sub-superscripts '{}   ; don't treat lone _ / ^ as sub/superscripts, require _{} / ^{}
       org-image-actual-width '(0.9)          ; Make the in-buffer display closer to the exported result..
       )
#+end_src

***** é›¶å®½ç©ºæ ¼
å¶å°”åœ¨ç”¨ Org æ˜¯ä½ å¸Œæœ›å°†ä¸¤ä¸ªåˆ†å¼€çš„å—æ”¾åœ¨ä¸€èµ·ï¼Œè¿™ç‚¹æœ‰ç‚¹çƒ¦äººã€‚æ¯”å¦‚å°†åŠ â€‹*é‡*â€‹ä¸€ä¸ªå•è¯
çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–è€…è¯´åœ¨å†…è”æºç å—ä¹‹å‰æ”¾ä¸€äº›ç¬¦å·ã€‚æœ‰ä¸€ä¸ªå¯ä»¥è§£å†³çš„æ–¹æ³• --- é›¶å®½ç©ºæ ¼ã€‚
ç”±äºè¿™æ˜¯ Emacsï¼Œæˆ‘ä»¬å¯ä»¥ä¸º org-mode åšä¸€ä¸ªå¾ˆå°çš„æ”¹åŠ¨å°†å…¶æ·»åŠ åˆ°å¿«æ·é”®ä¸Š ğŸ™‚ã€‚

#+begin_src emacs-lisp
(map! :map org-mode-map
      :leader
      :desc "zero-width-space" "SPC" (cmd! (insert "\u200B")))
#+end_src

ä¸è¿‡åœ¨å¯¼å‡ºæ—¶ï¼Œæˆ‘å¹¶ä¸æƒ³è¦å®ƒï¼ŒåŠ ä¸€ä¸ªç®€å•çš„è¿‡æ»¤å™¨å°†å…¶è¿‡æ»¤æ‰ã€‚
#+begin_src emacs-lisp
(defun +org-export-remove-zero-width-space (text _backend _info)
  "Remove zero width spaces from TEXT."
  (unless (org-export-derived-backend-p 'org)
    (replace-regexp-in-string "\u200B" "" text)))

(after! ox
  (add-to-list 'org-export-filter-final-output-functions #'+org-export-remove-zero-width-space t))
#+end_src

***** ç›®å½•ç”Ÿæˆ
ç”Ÿæˆç›®å½•çš„éœ€æ±‚å¹¶ä¸å¤§ï¼Œä½†æ˜¯åƒ =GitHub= çš„ç¯å¢ƒä¸‹ TOC å¯èƒ½æˆä¸ºå¿…è¦ï¼Œé‡‡ç”¨ ~toc-org~
æ¥ç”Ÿæˆã€‚
#+begin_src emacs-lisp :noweb-ref none :tangle yes
(use-package! toc-org
  :defer t
  :after (:any org markdown)
  :config
  (toc-org-mode t)
  (add-hook! '(org-mode-hook markdown-mode-hook) #'toc-org-mode)
  (define-key! org-mode-map "C-c C-i" #'toc-org-insert-toc)
  (define-key! markdown-mode-map "C-c M-t" #'toc-org-insert-toc))
#+end_src

=toc-org= ä¼šæ¸…ç©ºå¸¦æœ‰ ~TOC~ æ ‡ç­¾çš„ headingï¼Œå¹¶ç”Ÿæˆç›®å½•ã€‚

***** åŠ å¯†å—
=org-crypt= å¯ä»¥ç”¨ =GPG= åŠ å¯† Org Mode çš„æŸäº› headingï¼Œå½“ç„¶æ˜¯å¸¦æœ‰ ~crypt~ æ ‡ç­¾çš„ã€‚
ç°åœ¨æ¥è®¾ç½®ä¸€ä¸‹ã€‚
#+begin_src emacs-lisp :noweb-ref none :tangle no
(use-package! org-crypt
  :defer t
  :after org
  :custom
  (org-crypt-key user-gpg-key)
  (org-tags-exclude-from-inheritance '("crypt")) ;; avoid repeated encryption
  :config
  (org-crypt-use-before-save-magic) ;; encrypt when writing back to the hard disk
  (map! :map org-mode-map
        :localleader
        :desc "org-encrypt" "C" nil
        :desc "encrypt current" "C e" #'org-encrypt-entry
        :desc "encrypt all" "C E" #'org-encrypt-entries
        :desc "decrypt current" "C d" #'org-decrypt-entry
        :desc "decrypt all" "C D" #'org-decrypt-entries))
#+end_src

å¦‚æœæƒ³ç”¨å…¶ä»–å¯†é’¥åŠ å¯†ï¼Œå¯ä»¥è®¾ç½® ~cryptkey~ å±æ€§ã€‚
#+begin_example
,* Totally secret :crypt:
:properties:
:cryptkey: 0x0123456789012345678901234567890123456789
:end:
#+end_example

***** ä» Pandoc å¯¼å…¥
æœ‰æ—¶æˆ‘ä¸å¾—ä¸ä½¿ç”¨ Org-mode æ–‡ä»¶ï¼Œä½†å¹¸è¿çš„æ˜¯ï¼ŒPandoc æä¾›äº†å¤„ç†é Org-mode æ–‡ä»¶çš„
æ–¹æ³•ã€‚
#+begin_src emacs-lisp :tangle packages.el :comments no :noweb-ref none
(package! org-pandoc-import :recipe
  (:host github :repo "tecosaur/org-pandoc-import" :files ("*.el" "filters" "preprocessors")))
#+end_src

#+begin_src emacs-lisp :tangle yes :noweb-ref none
(use-package! org-pandoc-import
  :after org)
#+end_src

**** æ ‡é¢˜ç»“æ„
è¯´èµ·æ ‡é¢˜è¡Œï¼Œæˆ‘æ³¨æ„åˆ°äº†ä¸€ä¸ªéå¸¸æ£’çš„åŒ…ï¼Œå®ƒå¯ä»¥æµè§ˆå¹¶ç®¡ç†æ ‡é¢˜ç»“æ„ã€‚
#+begin_src emacs-lisp :tangle packages.el :comments no :noweb-ref none
(package! org-ol-tree :recipe (:host github :repo "Townk/org-ol-tree"))
#+end_src

#+begin_src emacs-lisp :tangle no :noweb-ref none
(use-package! org-ol-tree
  :defer t
  :after org
  :commands org-ol-tree
  :config
  (setq org-ol-tree-ui-icon-set
        (if (and (display-graphic-p)
                 (fboundp 'all-the-icons-material))
            'all-the-icons
          'unicode))
  (org-ol-tree-ui--update-icon-set)
  (map! :map org-mode-map
        :localleader
        :desc "Outline" "O" #'org-ol-tree))
#+end_src

**** Agenda
#+begin_src emacs-lisp :tangle yes :noweb-ref none
(defvar org-agenda-dir (concat org-directory "/" "agenda"))
(defvar org-agenda-todo-file (expand-file-name "todo.org" org-agenda-dir))
(defvar org-agenda-project-file (expand-file-name "project.org" org-agenda-dir))
(after! org-agenda
  ;;urgancy|soon|as soon as possible|at some point|eventually
  ;;
  (setq! org-agenda-files `(,org-agenda-todo-file
                            ,org-agenda-project-file)
         org-agenda-skip-scheduled-if-done t
         org-agenda-skip-deadline-if-done t
         org-agenda-include-deadlines t
         org-agenda-block-separator nil
         org-agenda-tags-column 100 ;; from testing this seems to be a good value
         org-agenda-compact-blocks t))
#+end_src

**** Capture
å¼€å§‹è®¾ç½® Org-capture æ¨¡æ¿å§ï¼Œå¿«é€Ÿè®°å½•ï¼

#+begin_src emacs-lisp :noweb-ref none :tangle no
(after! org-capture
  (defun ginshio/find-project-tree(priority)
    "find or create project headline
https://www.zmonster.me/2018/02/28/org-mode-capture.html"
    (let* ((hl (let ((headlines (org-element-map (org-element-parse-buffer 'headline) 'headline
                                  (lambda (hl) (and (= (org-element-property :level hl) 1)
                                               (org-element-property :title hl))))))
                 (completing-read "Project Name: " headlines))))
      (goto-char (point-min))
      (if (re-search-forward
           (format org-complex-heading-regexp-format (regexp-quote hl)) nil t)
          (goto-char (point-at-bol))
        (progn
          (or (bolp) (insert "\n"))
          (if (/= (point) (point-min)) (org-end-of-subtree))
          (insert (format "* %s :project:%s:\n:properties:\n:homepage: %s\n:repo: \
%s\n:end:\n\n** urgancy :urgancy:\n\n** soon :soon:\n\n** as soon as\
 possible :asap:\n\n** at some point :asp:\n\n** eventually :eventually:\n"
                          hl hl (read-string "homepage: ") (read-string "repo: ")))
          (beginning-of-line 0)
          (org-up-heading-safe))))
    (re-search-forward
     (format org-complex-heading-regexp-format
             (regexp-quote priority))
     (save-excursion (org-end-of-subtree t t)) t)
    (org-end-of-subtree))
  (setq! org-capture-dir (expand-file-name "capture" org-directory)
         org-capture-snippet-file (expand-file-name "snippets.org" org-capture-dir)
         org-capture-comment-file (expand-file-name "comments.org" org-capture-dir)
         org-capture-note-file (expand-file-name "notes.org" org-capture-dir)
         org-capture-blog-file (expand-file-name "blogs.org" org-capture-dir)
         )
  ;; http://www.howardism.org/Technical/Emacs/journaling-org.html
  ;; https://www.zmonster.me/2018/02/28/org-mode-capture.html
  (setq org-capture-templates
        `(("B" "Blog TODO List" entry (file ,org-capture-blog-file)
           "* TODO [#%^{priority|D|A|B|C|E}] %^{blog_title}\n:properties:\n:categories: %^{categories}\n:tags: %^{tags}\n:title: %\\1\n:file_name: %^{file_name}\n:end:\n%?"
           :empty-lines 1)
          ("c" "Comment")
          ("cb" "Book" entry (file+weektree ,org-capture-comment-file)
           "* %^{book} :book:%\\1:\n%?" :empty-lines 1)
          ("cm" "Movie" entry (file+weektree ,org-capture-comment-file)
           "* %^{movie} :movie:%\\1:\n%?" :empty-lines 1)
          ("g" "GTD")
          ("gt" "Todo" entry (file+headline org-agenda-todo-file "Personal")
           "* TODO [#%^{priority|A|B|C|D|E}] %^{task}\n  SCHEDULED: %^T DEADLINE: %^T\n:properties:\n:end:\n%?"
           :empty-lines 1)
          ("gi" "Interview" entry (file+headline ,org-agenda-todo-file "Interview")
           "* WAIT [#%^{priority|B|A|C|D}] %^{company} - %^{position}\t:%\\2:\nSCHEDULED: %^T DEADLINE: %^T\n:properties:\n:url: %^{link}\n:end:\n%?"
           :prepend t :empty-lines 1)
          ("gd" "Daily" entry (file+headline ,org-agenda-todo-file "Daily")
           "* TODO [#%^{priority|C|A|B|D|E}] %^{task}\n SCHEDULED:  %<<%Y-%m-%d %a %H:%M ++1d>>\n:properties:\n:end:\n%?"
           :empty-lines 1)
          ("gw" "Weekly" entry (file+headline ,org-agenda-todo-file "Weekly")
           "* TODO [#%^{priority|B|A|C|D|E}] %^{task}\n SCHEDULED: %<<%Y-%m-%d %a %H:%M ++1w>>\n:properties:\n:end:\n%?"
           :empty-lines 1)
          ("gm" "Monthly" entry (file+headline ,org-agenda-todo-file "Monthly")
           "* TODO [#%^{priority|C|A|B|D|E}] %^{task}\n SCHEDULED: %<<%Y-%m-%d %a %H:%M ++1m>>\n:properties:\n:end:\n%?"
           :empty-lines 1)
          ("n" "Note")
          ("nc" "Computer" entry (file+headline ,org-capture-note-file "Computer")
           "* %^{heading} %^g\n%?\n" :empty-lines 1)
          ("ne" "Emacs" entry (file+headline ,org-capture-note-file "Emacs")
           "* %^{heading} %^g\n%?\n" :empty-lines 1)
          ("ng" "Game" entry (file+headline ,org-capture-note-file "Game")
           "* %^{heading} %^g\n%?\n" :empty-lines 1)
          ;; ("p" "Project")
          ;; ("pa" "Urgance" entry (file+function ,org-agenda-project-file
          ;;                                      (lambda () (ginshio/find-project-tree "urgancy")))
          ;;  "*** TODO [#A] %^{task}\n SCHEDULED: %<<%Y-%m-%d %a %H:%M>> DEADLINE: %^T\n    :properties:\n    :end:\n%?"
          ;;  :empty-lines 1)
          ;; ("pb" "Soon" entry (file+function ,org-agenda-project-file
          ;;                                   (lambda () (ginshio/find-project-tree "soon")))
          ;;  "*** TODO [#B] %^{task}\n SCHEDULED: %<<%Y-%m-%d %a %H:%M>> DEADLINE: %^T\n    :properties:\n    :end:\n%?"
          ;;  :empty-lines 1)
          ;; ("pc" "As Soon As Possiple" entry (file+function ,org-agenda-project-file
          ;;                                                  (lambda () (ginshio/find-project-tree "as soon as possiple")))
          ;;  "*** TODO [#C] %^{task}\n SCHEDULED: %<<%Y-%m-%d %a %H:%M>> DEADLINE: %^T\n    :properties:\n    :end:\n%?"
          ;;  :empty-lines 1)
          ;; ("pd" "At Some Point" entry (file+function ,org-agenda-project-file
          ;;                                            (lambda () (ginshio/find-project-tree "at some point")))
          ;;  "*** TODO [#D] %^{task}\n SCHEDULED: %<<%Y-%m-%d %a %H:%M>> DEADLINE: %^T\n    :properties:\n    :end:\n%?"
          ;;  :empty-lines 1)
          ;; ("pe" "Eventually" entry (file+function ,org-agenda-project-file
          ;;                                         (lambda () (ginshio/find-project-tree "eventually")))
          ;;  "*** TODO [#E] %^{task}\n SCHEDULED: %<<%Y-%m-%d %a %H:%M>> DEADLINE: %^T\n    :properties:\n    :end:\n%?"
          ;;  :empty-lines 1)
          ("s" "Code Snippet" entry (file ,org-capture-snippet-file)
           "* %^{heading} :code:%\\2:\n:properties:\n:language: %^{language}\n:end:\n\n#+begin_src %\\2\n%?\n#+end_src"
           :empty-lines 1)
          )))
#+end_src

**** å¼•ç”¨
å¶å°”ä¼šå¼•ç”¨æŸäº›ä¸œè¥¿ï¼Œå½“ç„¶è¿˜æœ‰ä¹‹å‰çš„ =calibre= ã€‚è®¾ç½®ä¸€ä¸‹ï¼Œè®© =org= ã€ =LaTeX= ä»¥
åŠ =markdown= å¯ä»¥ä½¿ç”¨ citarã€‚

#+begin_src emacs-lisp :noweb-ref none :tangle no
(use-package! citar
  :defer t
  :after (:any org TeX markdown)
  :init
  (setq! citar-symbols
         `((file ,(all-the-icons-faicon "file-o" :face 'all-the-icons-green :v-adjust -0.1) . " ")
           (note ,(all-the-icons-material "speaker_notes" :face 'all-the-icons-blue :v-adjust -0.3) . " ")
           (link ,(all-the-icons-octicon "link" :face 'all-the-icons-orange :v-adjust 0.01) . " "))
         citar-symbol-separator "  ")
  (map! :map (org-mode-map TeX-mode-map markdown-mode-map)
        "C-c b" #'citar-insert-citation)
  (map! :map minibuffer-local-map
        "M-b" #'citar-insert-preset)
  :custom
  ;; (org-cite-global-bibliography '("~/library/ebooks/catalog.bib"
  ;;                                 "~/library/papers/catalog.bib"))
  (org-cite-insert-processor 'citar)
  (org-cite-follow-processor 'citar)
  (org-cite-activate-processor 'citar)
  (citar-bibliography org-cite-global-bibliography)
  :config
  (add-to-list 'citar-major-mode-functions
               '((gfm-mode)
                 (insert-keys . citar-markdown-insert-keys)
                 (insert-citation . citar-markdown-insert-citation)
                 (insert-edit . citar-markdown-insert-edit)
                 (key-at-point . citar-markdown-key-at-point)
                 (citation-at-point . citar-markdown-citation-at-point)
                 (list-keys . citar-markdown-list-keys))))
#+end_src

ä¸»è¦ä¸ºäº†å¼•ç”¨çš„çµæ´»æ€§ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰è®¾ç½®å…¨å±€ bibï¼Œå¦‚æœæƒ³åœ¨ Org é‡Œå¼•ç”¨æŸäº› bib æ–‡ä»¶å¯
ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•ã€‚
#+begin_example
,#+bibliography: ~/library/ebooks/catalog.bib
,#+bibliography: ~/library/papers/catalog.bib
#+end_example

å½“ç„¶è¿™é…ç½®å¾ˆç®€å•ï¼Œåªä¸è¿‡åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œå…³äº =org-cite= å’Œ =citar= è¦å­¦çš„è¿˜æœ‰å¾ˆå¤šã€‚
å¯ä»¥çœ‹çœ‹ [[https://blog.tecosaur.com/tmio/2021-07-31-citations.html][è¿™ç¯‡]]ã€‚

*** è§†è§‰
**** Org Modern
ä½¿ =org-mode= buffer å°½å¯èƒ½æ¼‚äº®æ˜¯å¾ˆé‡è¦çš„ï¼ŒMinad çš„ =org-modern= åœ¨è¿™æ–¹é¢å¤§æœ‰å¸®åŠ©ã€‚

#+begin_src emacs-lisp :noweb-ref none :tangle packages.el
(package! org-modern)
#+end_src

...è¿˜æœ‰ä¸€äº›é…ç½®...
#+begin_src emacs-lisp :tangle yes
(use-package! org-modern
  :hook
  (org-mode . org-modern-mode)
  (org-agenda-finalize . org-modern-agenda)
  :config
  ;;(setq org-modern-star '("â™‡" "â™†" "â™…" "â™„" "â™ƒ" "â™‚" "â™€" "â˜¿")
  (setq org-modern-star '("â—‰" "â—‹" "âœ¸" "âœ¿" "âœ¤" "âœœ" "â—†" "â–¶")
        org-modern-table-vertical 1
        org-modern-table-horizontal 0.2
        org-modern-list '((43 . "â¤")
                          (45 . "â€“")
                          (42 . "â€¢"))
        org-modern-todo-faces '(("TODO" :inverse-video t :inherit org-todo)
                                ("PROJ" :inverse-video t :inherit +org-todo-project)
                                ("STRT" :inverse-video t :inherit +org-todo-active)
                                ("[-]"  :inverse-video t :inherit +org-todo-active)
                                ("HOLD" :inverse-video t :inherit +org-todo-onhold)
                                ("WAIT" :inverse-video t :inherit +org-todo-onhold)
                                ("[?]"  :inverse-video t :inherit +org-todo-onhold)
                                ("KILL" :inverse-video t :inherit +org-todo-cancel)
                                ("NO"   :inverse-video t :inherit +org-todo-cancel))
        org-modern-footnote (cons nil (cadr org-script-display))
        org-modern-progress nil
        org-modern-priority nil
        org-modern-horizontal-rule (make-string 36 ?â”€)

        org-auto-align-tags nil
        org-tags-column 0
        org-catch-invisible-edits 'show-and-error
        org-special-ctrl-a/e t
        org-hide-emphasis-markers t

        org-agenda-tags-column  0
        org-agenda-block-separator ?â”€
        org-agenda-time-grid '((daily today require-timed)
                               (800 1000 1200 1400 1600 1800 2000)
                               " â”„â”„â”„â”„â”„ " "â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„")
        org-agenda-current-time-string "â­  now â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        )
  (custom-set-faces! '(org-modern-statistics :inherit org-checkbox-statistics-todo)))
#+end_src

ç”±äº =org-modern= çš„æ ‡ç­¾é¢å–ä»£äº† Org çš„æ ‡ç­¾é¢ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´æ‹¼å†™æ£€æŸ¥é¢å¿½ç•¥åˆ—è¡¨ã€‚

#+begin_src emacs-lisp :tangle yes
(after! spell-fu
  (cl-pushnew 'org-modern-tag (alist-get 'org-mode +spell-excluded-faces-alist)))
#+end_src

**** å¼ºè°ƒæ ‡è®°
è™½ç„¶ ~org-hide-emphasis-markers~ éå¸¸å¥½ï¼Œä½†æœ‰æ—¶å®ƒä¼šä½¿è¾¹ç•Œå¤„çš„ç¼–è¾‘å˜å¾—æ›´åŠ ç¹çã€‚
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ =org-appear= åŒ…åœ¨ä¸ç‰ºç‰²è§†è§‰ä¾¿åˆ©çš„æƒ…å†µä¸‹æ”¹å–„è¿™ç§æƒ…å†µã€‚

#+begin_src emacs-lisp :noweb-ref none :tangle packages.el
(package! org-appear
  :recipe (:host github :repo "awth13/org-appear"))
#+end_src

#+begin_src emacs-lisp :tangle yes
(use-package! org-appear
  :hook (org-mode . org-appear-mode)
  :config
  (setq org-appear-autoemphasis t
        org-appear-autosubmarkers t
        org-appear-autolinks nil)
  ;; for proper first-time setup, `org-appear--set-elements'
  ;; needs to be run after other hooks have acted.
  (run-at-time nil nil #'org-appear--set-elements))
#+end_src

**** ç¬¦å·
æ›´æ”¹ç”¨äºæŠ˜å é¡¹ç›®çš„å­—ç¬¦ä¹Ÿå¾ˆå¥½ (é»˜è®¤æƒ…å†µä¸‹ ~â€¦~)ï¼Œæˆ‘è®¤ä¸ºç”¨ ~â–¾~ æ›´é€‚åˆæŒ‡ç¤º ã€ŒæŠ˜å éƒ¨
åˆ†ã€ã€‚å¹¶åœ¨é»˜è®¤çš„å››ä¸ªåˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªé¢å¤–çš„ ~org-bullet~ ã€‚å¯¹äº†ï¼Œåˆ«å¿˜è®°ä¼˜å…ˆçº§ä¹Ÿè¦ä¿®
æ”¹ã€‚

#+begin_src emacs-lisp :noweb-ref none :tangle yes
(after! org-fancy-priorities
  (custom-set-variables '(org-lowest-priority ?E))
  (setq! org-fancy-priorities-list '("âš¡" "â†‘" "â†“" "â˜•" "â“")))
#+end_src

#+begin_src emacs-lisp
(setq! org-ellipsis " â–¾ "
       org-hide-leading-stars t
       org-priority-highest ?A
       org-priority-lowest ?E
       org-priority-faces
       '((?A . 'all-the-icons-red)
         (?B . 'all-the-icons-orange)
         (?C . 'all-the-icons-yellow)
         (?D . 'all-the-icons-green)
         (?E . 'all-the-icons-blue)))
#+end_src

**** Org Plot
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ =org-plot= ä¸­çš„ä¸€äº›å˜é‡æ¥ä½¿ç”¨å½“å‰çš„ doom ä¸»é¢˜é¢œè‰²ã€‚

#+begin_src emacs-lisp :noweb no-export :noweb-ref none :tangle yes
(defvar +org-plot-term-size '(1050 . 650)
  "The size of the GNUPlot terminal, in the form (WIDTH . HEIGHT).")

(after! org-plot
  (defun +org-plot-generate-theme (_type)
    "Use the current Doom theme colours to generate a GnuPlot preamble."
    (format "
fgt = \"textcolor rgb '%s'\" # foreground text
fgat = \"textcolor rgb '%s'\" # foreground alt text
fgl = \"linecolor rgb '%s'\" # foreground line
fgal = \"linecolor rgb '%s'\" # foreground alt line

# foreground colors
set border lc rgb '%s'
# change text colors of  tics
set xtics @fgt
set ytics @fgt
# change text colors of labels
set title @fgt
set xlabel @fgt
set ylabel @fgt
# change a text color of key
set key @fgt

# line styles
set linetype 1 lw 2 lc rgb '%s' # red
set linetype 2 lw 2 lc rgb '%s' # blue
set linetype 3 lw 2 lc rgb '%s' # green
set linetype 4 lw 2 lc rgb '%s' # magenta
set linetype 5 lw 2 lc rgb '%s' # orange
set linetype 6 lw 2 lc rgb '%s' # yellow
set linetype 7 lw 2 lc rgb '%s' # teal
set linetype 8 lw 2 lc rgb '%s' # violet

# border styles
set tics out nomirror
set border 3

# palette
set palette maxcolors 8
set palette defined ( 0 '%s',\
1 '%s',\
2 '%s',\
3 '%s',\
4 '%s',\
5 '%s',\
6 '%s',\
7 '%s' )
"
            (doom-color 'fg)
            (doom-color 'fg-alt)
            (doom-color 'fg)
            (doom-color 'fg-alt)
            (doom-color 'fg)
            ;; colours
            (doom-color 'red)
            (doom-color 'blue)
            (doom-color 'green)
            (doom-color 'magenta)
            (doom-color 'orange)
            (doom-color 'yellow)
            (doom-color 'teal)
            (doom-color 'violet)
            ;; duplicated
            (doom-color 'red)
            (doom-color 'blue)
            (doom-color 'green)
            (doom-color 'magenta)
            (doom-color 'orange)
            (doom-color 'yellow)
            (doom-color 'teal)
            (doom-color 'violet)))

  (defun +org-plot-gnuplot-term-properties (_type)
    (format "background rgb '%s' size %s,%s"
            (doom-color 'bg) (car +org-plot-term-size) (cdr +org-plot-term-size)))

  (setq org-plot/gnuplot-script-preamble #'+org-plot-generate-theme)
  (setq org-plot/gnuplot-term-extra #'+org-plot-gnuplot-term-properties))
#+end_src

**** å­—ä½“åŒ–å†…è” src å—

Org ä½¿ç”¨ =#+begin_src= å—åšäº†ä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚åœ¨å¹•åä½¿ç”¨ font-lock ä½œä¸ºè¯­è¨€çš„ä¸»è¦æ¨¡
å¼å¹¶æ‹‰å‡ºè‰¯å¥½çš„å½©è‰²ç»“æœã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå†…è” =src_= å—åœ¨æŸç§ç¨‹åº¦ä¸Šè¢«å¿½ç•¥äº†ã€‚

æˆ‘ä¸æ˜¯ç¬¬ä¸€ä¸ªæœ‰è¿™ç§æ„Ÿè§‰çš„äºº, å¹¸å¥½ä»–ä»¬å·²ç»å¼€å§‹åœ¨ [[https://stackoverflow.com/questions/20309842/how-to-syntax-highlight-for-org-mode-inline-source-code-src-lang/28059832][stackexchange]] ä¸Šå¼€å§‹è®¨è®ºäº†ã€‚ æˆ‘æ‰“
ç®—ç›´æ¥ä½¿ç”¨ä»–ä»¬çš„ç»“æœï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œä»–ä»¬æ²¡æœ‰æ‰§è¡Œ /true/ æºä»£ç å­—ä½“åŒ–ï¼Œè€Œåªæ˜¯å°†
=org-code= åº”ç”¨åœ¨å†…å®¹ä¸Šã€‚

æˆ‘ä»¬å¯ä»¥åšå¾—æ¯”è¿™æ›´å¥½ï¼ä½¿ç”¨ ~org-src-font-lock-fontify-block~ æˆ‘ä»¬å¯ä»¥åº”ç”¨é€‚åˆè¯­
è¨€çš„è¯­æ³•é«˜äº®ã€‚ç„¶åï¼Œç»§ç»­åˆ° ={{{results(...)}}}=ï¼Œå®ƒå¯ä»¥å°† =org-block= åº”ç”¨ç›¸åº”çš„
è§„åˆ™ï¼Œç„¶åé€šè¿‡æ¨¡ä»¿ ~prettify-symbols-mode~ çš„è¡Œä¸ºéšè—å€¼åŒ…å›´ç»“æ„ã€‚

#+begin_warning
ä½†ç›®å‰åªèƒ½ä¸€è¡Œé«˜äº®ä¸€ä¸ªå†…è” src å—ã€‚æˆ‘ä¸çŸ¥é“å®ƒä¸ºä»€ä¹ˆä¼šåœæ­¢ï¼Œæˆ‘å¸Œæœ›å®ƒæ­£å¸¸ã€‚å¦‚æœæ‚¨
çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆæˆ–å¦‚ä½•è§£å†³æ­¤é—®é¢˜ /è¯·/ è”ç³»ã€‚
#+end_warning

#+begin_src emacs-lisp
(setq org-inline-src-prettify-results '("âŸ¨" . "âŸ©"))
#+end_src

Doom ä¸»é¢˜çš„é¢å¤–å­—ä½“åŒ–é—®é¢˜å¤šäºå¸®åŠ©ã€‚
#+begin_src emacs-lisp
(setq doom-themes-org-fontify-special-tags nil)
#+end_src

*** å¯¼å‡º
é»˜è®¤æƒ…å†µä¸‹ï¼ŒOrg ä»…å°†å‰ä¸‰ä¸ªçº§åˆ«çš„æ ‡é¢˜å¯¼å‡ºä¸ºæ ‡é¢˜ã€‚å½“ä½¿ç”¨ =article= æ—¶ï¼ŒLaTeX æ ‡é¢˜
ä» =\section= ã€ =\subsection= ã€ =\subsubsection= å’Œ =\paragraph= ã€
=\subgraph= --- /äº”/ ä¸ªçº§åˆ«ã€‚HTML5 æœ‰å…­çº§æ ‡é¢˜ (=<h1>= åˆ° =<h6>=)ï¼Œä½†ç¬¬ä¸€çº§ Org
æ ‡é¢˜è¢«å¯¼å‡ºä¸º =<h2>= å…ƒç´  --- å‰©ä¸‹ /äº”/ ä¸ªå¯ç”¨çº§åˆ«ã€‚

#+begin_src emacs-lisp
(setq! org-export-headline-levels 5)
#+end_src

æˆ‘è¿˜å°†ä½¿ç”¨ =ox-extra= ä¸­çš„ä¸€ä¸ªé¡¹ç›®ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥åœ¨æ ‡é¢˜ä¸­æ·»åŠ ä¸€ä¸ª =:ignore:= æ ‡è®°ä»¥
ä¿ç•™å†…å®¹ï¼Œä½†æ ‡é¢˜æœ¬èº«ä¼šè¢«å¿½ç•¥ï¼ˆâ€‹=:noexport:= å®ƒå¿½ç•¥äº†æ ‡é¢˜å’Œå†…å®¹ï¼‰ã€‚å½“æˆ‘æƒ³ä½¿ç”¨æ ‡é¢˜
æ¥æä¾›æœªå‡ºç°åœ¨æœ€ç»ˆæ–‡æ¡£ä¸­çš„å†™ä½œç»“æ„æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚

#+begin_src emacs-lisp
(require 'ox-extra)
(ox-extras-activate '(ignore-headlines))
#+end_src

ç”±äºæˆ‘ï¼ˆå¤§è‡´ï¼‰è·Ÿè¸ª Org ~HEAD~â€‹ï¼Œå› æ­¤åœ¨åˆ›å»ºè€…å­—ç¬¦ä¸²ä¸­åŒ…å« git ç‰ˆæœ¬æ˜¯æœ‰æ„ä¹‰çš„ã€‚
#+begin_src emacs-lisp
(setq org-export-creator-string
      (format "Emacs %s (Org mode %sâ€“%s)" emacs-version (org-release) (org-git-version)))
#+end_src

*** HTML å¯¼å‡º
:properties:
:header-args:emacs-lisp: :noweb-ref ox-html-conf
:end:

#+begin_src emacs-lisp :noweb no-export :noweb-ref none :tangle yes
(after! ox-html
  <<ox-html-conf>>
)
#+end_src

#+begin_src emacs-lisp
(define-minor-mode org-fancy-html-export-mode
  "Toggle my fabulous org export tweaks. While this mode itself does a little bit,
the vast majority of the change in behaviour comes from switch statements in:
 - `org-html-template-fancier'
 - `org-html--build-meta-info-extended'
 - `org-html-src-block-collapsable'
 - `org-html-block-collapsable'
 - `org-html-table-wrapped'
 - `org-html--format-toc-headline-colapseable'
 - `org-html--toc-text-stripped-leaves'
 - `org-export-html-headline-anchor'"
  :global t
  :init-value t
  (if org-fancy-html-export-mode
      (setq org-html-style-default org-html-style-fancy
            org-html-meta-tags #'org-html-meta-tags-fancy
            org-html-checkbox-type 'html-span)
    (setq org-html-style-default org-html-style-plain
          org-html-meta-tags #'org-html-meta-tags-default
          org-html-checkbox-type 'html)))
#+end_src

**** é¢å¤–çš„ head

åœ¨ä¸»ä½“çš„å¼€å¤´æ·»åŠ æ›´å¤šä¿¡æ¯ï¼Œåœ¨é¡µçœ‰ä¸­æ·»åŠ æ—¥æœŸå’Œä½œè€…ï¼Œå®ç°ä»… CSS çš„äº®/æš—ä¸»é¢˜åˆ‡æ¢ï¼Œä»¥åŠä¸€äº›
[[https://ogp.me/][Open Graph]] å…ƒæ•°æ®ã€‚
#+begin_src emacs-lisp
(defadvice! org-html-template-fancier (orig-fn contents info)
  "Return complete document string after HTML conversion.
CONTENTS is the transcoded contents string.  INFO is a plist
holding export options. Adds a few extra things to the body
compared to the default implementation."
  :around #'org-html-template
  (if (or (not org-fancy-html-export-mode) (bound-and-true-p org-msg-export-in-progress))
      (funcall orig-fn contents info)
    (concat
     (when (and (not (org-html-html5-p info)) (org-html-xhtml-p info))
       (let* ((xml-declaration (plist-get info :html-xml-declaration))
              (decl (or (and (stringp xml-declaration) xml-declaration)
                        (cdr (assoc (plist-get info :html-extension)
                                    xml-declaration))
                        (cdr (assoc "html" xml-declaration))
                        "")))
         (when (not (or (not decl) (string= "" decl)))
           (format "%s\n"
                   (format decl
                           (or (and org-html-coding-system
                                    (fboundp 'coding-system-get)
                                    (coding-system-get org-html-coding-system 'mime-charset))
                               "utf-8"))))))
     (org-html-doctype info)
     "\n"
     (concat "<html"
             (cond ((org-html-xhtml-p info)
                    (format
                     " xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"%s\" xml:lang=\"%s\""
                     (plist-get info :language) (plist-get info :language)))
                   ((org-html-html5-p info)
                    (format " lang=\"%s\"" (plist-get info :language))))
             ">\n")
     "<head>\n"
     (org-html--build-meta-info info)
     (org-html--build-head info)
     (org-html--build-mathjax-config info)
     "</head>\n"
     "<body>\n<input type='checkbox' id='theme-switch'><div id='page'><label id='switch-label' for='theme-switch'></label>"
     (let ((link-up (org-trim (plist-get info :html-link-up)))
           (link-home (org-trim (plist-get info :html-link-home))))
       (unless (and (string= link-up "") (string= link-home ""))
         (format (plist-get info :html-home/up-format)
                 (or link-up link-home)
                 (or link-home link-up))))
     ;; Preamble.
     (org-html--build-pre/postamble 'preamble info)
     ;; Document contents.
     (let ((div (assq 'content (plist-get info :html-divs))))
       (format "<%s id=\"%s\">\n" (nth 1 div) (nth 2 div)))
     ;; Document title.
     (when (plist-get info :with-title)
       (let ((title (and (plist-get info :with-title)
                         (plist-get info :title)))
             (subtitle (plist-get info :subtitle))
             (html5-fancy (org-html--html5-fancy-p info)))
         (when title
           (format
            (if html5-fancy
                "<header class=\"page-header\">%s\n<h1 class=\"title\">%s</h1>\n%s</header>"
              "<h1 class=\"title\">%s%s</h1>\n")
            (if (or (plist-get info :with-date)
                    (plist-get info :with-author))
                (concat "<div class=\"page-meta\">"
                        (when (plist-get info :with-date)
                          (org-export-data (plist-get info :date) info))
                        (when (and (plist-get info :with-date) (plist-get info :with-author)) ", ")
                        (when (plist-get info :with-author)
                          (org-export-data (plist-get info :author) info))
                        "</div>\n")
              "")
            (org-export-data title info)
            (if subtitle
                (format
                 (if html5-fancy
                     "<p class=\"subtitle\" role=\"doc-subtitle\">%s</p>\n"
                   (concat "\n" (org-html-close-tag "br" nil info) "\n"
                           "<span class=\"subtitle\">%s</span>\n"))
                 (org-export-data subtitle info))
              "")))))
     contents
     (format "</%s>\n" (nth 1 (assq 'content (plist-get info :html-divs))))
     ;; Postamble.
     (org-html--build-pre/postamble 'postamble info)
     ;; Possibly use the Klipse library live code blocks.
     (when (plist-get info :html-klipsify-src)
       (concat "<script>" (plist-get info :html-klipse-selection-script)
               "</script><script src=\""
               org-html-klipse-js
               "\"></script><link rel=\"stylesheet\" type=\"text/css\" href=\""
               org-html-klipse-css "\"/>"))
     ;; Closing document.
     "</div>\n</body>\n</html>")))
#+end_src

**** è‡ªå®šä¹‰ CSS/JS
[[https://lepisma.xyz][lepisma.xyz]] æ‰€åšçš„å¯¼å‡ºé£æ ¼éå¸¸è®¨å–œã€‚

#+begin_src html :tangle misc/org-export-header.html :comments no
<link rel="icon" href="https://tecosaur.com/resources/org/nib.ico" type="image/ico" />

<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/etbookot-roman-webfont.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/etbookot-italic-webfont.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/Merriweather-TextRegular.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/Merriweather-TextItalic.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/Merriweather-TextBold.woff2">
#+end_src

#+begin_src emacs-lisp
(setq! org-html-style-plain org-html-style-default
       org-html-htmlize-output-type 'css
       org-html-doctype "html5"
       org-html-html5-fancy t)

(defun org-html-reload-fancy-style ()
  (interactive)
  (setq org-html-style-fancy
        (concat (f-read-text (expand-file-name "misc/org-export-header.html" doom-private-dir))
                "<script>\n"
                (f-read-text (expand-file-name "misc/org-css/main.js" doom-private-dir))
                "</script>\n<style>\n"
                (f-read-text (expand-file-name "misc/org-css/main.min.css" doom-private-dir))
                "</style>"))
  (when org-fancy-html-export-mode
    (setq org-html-style-default org-html-style-fancy)))
(org-html-reload-fancy-style)
#+end_src

**** å¯æŠ˜å çš„ src å’Œç¤ºä¾‹å—
é€šè¿‡å°† ~<pre>~ å…ƒç´ åŒ…è£…åœ¨ ~<details>~ å—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ²¡æœ‰ CSS çš„å¯æŠ˜å å—ï¼Œ
å°½ç®¡æˆ‘ä»¬ä¼šç¨å¾®æŠ˜è…¾ä¸€ä¸‹ï¼Œè®©è¿™çœ‹èµ·æ¥æœ‰ç‚¹æ¼‚äº®ã€‚

ç”±äºé»˜è®¤æƒ…å†µä¸‹å¯¹æŸäº›ä»£ç å—å¯ç”¨å¯æŠ˜å æ€§ä¼¼ä¹å¾ˆæœ‰ç”¨ï¼Œå› æ­¤å¦‚æœæ‚¨å¯ä»¥ä½¿ç”¨
=#+attr_html: :collapsed t= è®¾ç½®å®ƒä¼šæ›´å¥½ã€‚

å¦‚æœæœ‰ä¸€ä¸ªç›¸åº”çš„å…¨å±€/ä¼šè¯æœ¬åœ°æ–¹å¼æ¥è®¾ç½®å®ƒä¼šå¾ˆå¥½ï¼Œä½†æˆ‘è¿˜æ²¡èƒ½è®©å®ƒæ­£å¸¸å·¥ä½œã€‚

#+begin_src emacs-lisp
(defvar org-html-export-collapsed nil)
(eval '(cl-pushnew '(:collapsed "COLLAPSED" "collapsed" org-html-export-collapsed t)
                   (org-export-backend-options (org-export-get-backend 'html))))
(add-to-list 'org-default-properties "EXPORT_COLLAPSED")
#+end_src

æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä¿®æ”¹ src å—ï¼Œå¹¶åœ¨ src å—çš„ä¸€ä¾§æ·»åŠ ä¸€ä¸ªå—ï¼Œå…¶ä¸­åŒ…å«å¼•ç”¨å½“å‰å—çš„é”šç‚¹å’Œ
å¤åˆ¶å—å†…å®¹çš„æŒ‰é’®ã€‚

#+begin_src emacs-lisp
(defadvice! org-html-src-block-collapsable (orig-fn src-block contents info)
  "Wrap the usual <pre> block in a <details>"
  :around #'org-html-src-block
  (if (or (not org-fancy-html-export-mode) (bound-and-true-p org-msg-export-in-progress))
      (funcall orig-fn src-block contents info)
    (let* ((properties (cadr src-block))
           (lang (mode-name-to-lang-name
                  (plist-get properties :language)))
           (name (plist-get properties :name))
           (ref (org-export-get-reference src-block info))
           (collapsed-p (member (or (org-export-read-attribute :attr_html src-block :collapsed)
                                    (plist-get info :collapsed))
                                '("y" "yes" "t" t "true" "all"))))
      (format
       "<details id='%s' class='code'%s><summary%s>%s</summary>
<div class='gutter'>
<a href='#%s'>#</a>
<button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>â˜</button>\
</div>
%s
</details>"
       ref
       (if collapsed-p "" " open")
       (if name " class='named'" "")
       (concat
        (when name (concat "<span class=\"name\">" name "</span>"))
        "<span class=\"lang\">" lang "</span>")
       ref
       (if name
           (replace-regexp-in-string (format "<pre\\( class=\"[^\"]+\"\\)? id=\"%s\">" ref) "<pre\\1>"
                                     (funcall orig-fn src-block contents info))
         (funcall orig-fn src-block contents info))))))

(defun mode-name-to-lang-name (mode)
  (or (cadr (assoc mode
                   '(("asymptote" "Asymptote")
                     ("awk" "Awk")
                     ("C" "C")
                     ("clojure" "Clojure")
                     ("css" "CSS")
                     ("D" "D")
                     ("ditaa" "ditaa")
                     ("dot" "Graphviz")
                     ("calc" "Emacs Calc")
                     ("emacs-lisp" "Emacs Lisp")
                     ("fortran" "Fortran")
                     ("gnuplot" "gnuplot")
                     ("haskell" "Haskell")
                     ("hledger" "hledger")
                     ("java" "Java")
                     ("js" "Javascript")
                     ("latex" "LaTeX")
                     ("ledger" "Ledger")
                     ("lisp" "Lisp")
                     ("lilypond" "Lilypond")
                     ("lua" "Lua")
                     ("matlab" "MATLAB")
                     ("mscgen" "Mscgen")
                     ("ocaml" "Objective Caml")
                     ("octave" "Octave")
                     ("org" "Org mode")
                     ("oz" "OZ")
                     ("plantuml" "Plantuml")
                     ("processing" "Processing.js")
                     ("python" "Python")
                     ("R" "R")
                     ("ruby" "Ruby")
                     ("sass" "Sass")
                     ("scheme" "Scheme")
                     ("screen" "Gnu Screen")
                     ("sed" "Sed")
                     ("sh" "shell")
                     ("sql" "SQL")
                     ("sqlite" "SQLite")
                     ("forth" "Forth")
                     ("io" "IO")
                     ("J" "J")
                     ("makefile" "Makefile")
                     ("maxima" "Maxima")
                     ("perl" "Perl")
                     ("picolisp" "Pico Lisp")
                     ("scala" "Scala")
                     ("shell" "Shell Script")
                     ("ebnf2ps" "ebfn2ps")
                     ("cpp" "C++")
                     ("abc" "ABC")
                     ("coq" "Coq")
                     ("groovy" "Groovy")
                     ("bash" "bash")
                     ("csh" "csh")
                     ("ash" "ash")
                     ("dash" "dash")
                     ("ksh" "ksh")
                     ("mksh" "mksh")
                     ("posh" "posh")
                     ("ada" "Ada")
                     ("asm" "Assembler")
                     ("caml" "Caml")
                     ("delphi" "Delphi")
                     ("html" "HTML")
                     ("idl" "IDL")
                     ("mercury" "Mercury")
                     ("metapost" "MetaPost")
                     ("modula-2" "Modula-2")
                     ("pascal" "Pascal")
                     ("ps" "PostScript")
                     ("prolog" "Prolog")
                     ("simula" "Simula")
                     ("tcl" "tcl")
                     ("tex" "LaTeX")
                     ("plain-tex" "TeX")
                     ("verilog" "Verilog")
                     ("vhdl" "VHDL")
                     ("xml" "XML")
                     ("nxml" "XML")
                     ("conf" "Configuration File"))))
      mode))
#+end_src

**** HTML åŒ–çš„å­—ä½“é”
Org ä½¿ç”¨ [[https://github.com/hniksic/emacs-htmlize][htmlize.el]] å¯¼å‡ºå¸¦æœ‰è¯­æ³•é«˜äº®çš„ç¼“å†²åŒºã€‚

åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¿™äº›æ ¼å¼éå¸¸æ£’ã€‚ä¸éœ€è¦åŠ è½½æä¾›å­—ä½“é”å®šçš„æ¬¡è¦æ¨¡å¼ï¼Œå› æ­¤ä¸ä¼šå½±å“ç»“æœã€‚

é€šè¿‡åœ¨ ~htmlize-before-hook~ ä¸­å¯ç”¨è¿™äº›æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥çº æ­£è¿™ç§è¡Œä¸ºã€‚
#+begin_src emacs-lisp
(autoload #'highlight-numbers--turn-on "highlight-numbers")
(add-hook 'htmlize-before-hook #'highlight-numbers--turn-on)
#+end_src

**** å¤„ç†è¡¨æº¢å‡º
ä¸ºäº†é€‚åº”å®½è¡¨ --- å°¤å…¶æ˜¯åœ¨ç§»åŠ¨è®¾å¤‡ä¸Š --- æˆ‘ä»¬æƒ³è¦è®¾ç½®æœ€å¤§å®½åº¦å’Œæ»šåŠ¨æº¢å‡ºã€‚ä¸å¹¸çš„æ˜¯ï¼Œ
è¿™ä¸èƒ½ç›´æ¥åº”ç”¨äº ~è¡¨æ ¼~ å…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å°†å®ƒåŒ…è£…åœ¨ä¸€ä¸ª ~div~ ä¸­ã€‚

å½“æˆ‘ä»¬è¿™æ ·åšæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åƒæˆ‘ä»¬å¯¹ src å—æ‰€åšçš„é‚£æ ·ï¼Œè®¾ç½®ä¸€ä¸ªé“¾æ¥å—ï¼Œå¹¶æ˜¾ç¤º
~#+name~ (å¦‚æœæœ‰çš„è¯)ã€‚
#+begin_src emacs-lisp
(defadvice! org-html-table-wrapped (orig-fn table contents info)
  "Wrap the usual <table> in a <div>"
  :around #'org-html-table
  (if (or (not org-fancy-html-export-mode) (bound-and-true-p org-msg-export-in-progress))
      (funcall orig-fn table contents info)
    (let* ((name (plist-get (cadr table) :name))
           (ref (org-export-get-reference table info)))
      (format "<div id='%s' class='table'>
<div class='gutter'><a href='#%s'>#</a></div>
<div class='tabular'>
%s
</div>\
</div>"
              ref ref
              (if name
                  (replace-regexp-in-string (format "<table id=\"%s\"" ref) "<table"
                                            (funcall orig-fn table contents info))
                (funcall orig-fn table contents info))))))
#+end_src

**** å¯å±•å¼€çš„ç›®å½•æ ‘
TOC ä½œä¸ºå¯æŠ˜å æ ‘æ›´æ˜“äºå¯¼èˆªã€‚ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½å•ç‹¬ä½¿ç”¨ CSS æ¥å®ç°è¿™ä¸€ç‚¹ã€‚å€¼å¾—åº†å¹¸
çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´ TOC ç”Ÿæˆä»£ç æ¥ä¸ºæ¯ä¸ªé¡¹ç›®ä½¿ç”¨ä¸€ä¸ª ~æ ‡ç­¾~ ï¼Œä»¥åŠä¸€ä¸ªéšè—çš„
~å¤é€‰æ¡†~ æ¥è·Ÿè¸ªçŠ¶æ€ï¼Œä»è€Œé¿å…ä½¿ç”¨ JSã€‚

è¦æ·»åŠ å®ƒï¼Œæˆ‘ä»¬éœ€è¦åœ¨ ~org-html--format-toc-headline~ ä¸­æ›´æ”¹ä¸€è¡Œã€‚

å› ä¸ºæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥é€šè¿‡åœ¨å‡½æ•°å‘¨å›´æ·»åŠ å»ºè®®æ¥å®ç°æ‰€éœ€çš„æ•ˆæœï¼Œè€Œæ— éœ€è¦†ç›–å®ƒ --- è®©æˆ‘ä»¬è¿™
æ ·åšæ¥å‡å°‘è¿™ä¸ªé…ç½®çš„é”™è¯¯è¡¨é¢ã€‚
#+begin_src emacs-lisp
(defadvice! org-html--format-toc-headline-colapseable (orig-fn headline info)
  "Add a label and checkbox to `org-html--format-toc-headline's usual output,
to allow the TOC to be a collapseable tree."
  :around #'org-html--format-toc-headline
  (if (or (not org-fancy-html-export-mode) (bound-and-true-p org-msg-export-in-progress))
      (funcall orig-fn headline info)
    (let ((id (or (org-element-property :CUSTOM_ID headline)
                  (org-export-get-reference headline info))))
      (format "<input type='checkbox' id='toc--%s'/><label for='toc--%s'>%s</label>"
              id id (funcall orig-fn headline info)))))
#+end_src

ç°åœ¨ï¼Œå¶å­ (æ²¡æœ‰å­æ ‡é¢˜çš„æ ‡é¢˜) ä¸åº”è¯¥æœ‰ ~æ ‡ç­¾é¡¹~ ã€‚å®ç°è¿™ä¸€ç‚¹çš„æ˜æ˜¾æ–¹æ³•æ˜¯åœ¨
~org-html--format-toc-headline-colapseable~ ä¸­åŒ…å«ä¸€äº› (å¦‚æœæ²¡æœ‰å­é¡¹) é€»è¾‘
ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘çš„ elisp æ— æ³•ä» org æä¾›çš„å¤§é‡ä¿¡æ¯ä¸­æå–å­æ ‡é¢˜çš„æ•°é‡ã€‚
#+begin_src emacs-lisp
(defadvice! org-html--toc-text-stripped-leaves (orig-fn toc-entries)
  "Remove label"
  :around #'org-html--toc-text
  (if (or (not org-fancy-html-export-mode) (bound-and-true-p org-msg-export-in-progress))
      (funcall orig-fn toc-entries)
    (replace-regexp-in-string "<input [^>]+><label [^>]+>\\(.+?\\)</label></li>" "\\1</li>"
                              (funcall orig-fn toc-entries))))
#+end_src

**** ä½¿ verbatim ä¸ code ä¸åŒ
è®©æˆ‘ä»¬ä¸º =varbatim= å’Œ ~code~ æ·»åŠ ä¸€äº›å·®å¼‚ã€‚

æˆ‘ä»¬å¯ä»¥å°† ~code~ ä¸“é—¨ç”¨äºä»£ç ç‰‡æ®µå’Œå‘½ä»¤ï¼Œä¾‹å¦‚ï¼šåœ¨ Emacs çš„æ‰¹å¤„ç†æ¨¡å¼ä¸­è°ƒç”¨
src_elisp{(message "Hello")} ä¼šåƒ ~echo~ ä¸€æ ·æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚ å¯ä»¥å¯¹
=verbatim= ä½¿ç”¨å„ç§ 'å…¶ä»–ç­‰å®½'ï¼Œä¾‹å¦‚é”®ç›˜å¿«æ·é”®ï¼š =C-c C-c= æˆ– =C-g= å¯èƒ½æ˜¯
Emacs ä¸­æœ€æœ‰ç”¨çš„å¿«æ·é”®ï¼Œæˆ–æ–‡ä»¶åï¼šæˆ‘å°†æˆ‘çš„é…ç½®ä¿å­˜åœ¨ =~/.config/doom/= ä¸­ï¼Œå…¶ä»–
æƒ…å†µåˆ™ä½¿ç”¨æ­£å¸¸æ ·å¼ã€‚

#+begin_src emacs-lisp
(setq org-html-text-markup-alist
      '((bold . "<b>%s</b>")
        (code . "<code>%s</code>")
        (italic . "<i>%s</i>")
        (strike-through . "<del>%s</del>")
        (underline . "<span class=\"underline\">%s</span>")
        (verbatim . "<kbd>%s</kbd>")))
#+end_src

**** æ”¹å˜å¤é€‰æ¡†ç±»å‹
æˆ‘ä»¬ä¹Ÿæƒ³ä½¿ç”¨ HTML å¤é€‰æ¡†ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³æ¯”é»˜è®¤çš„æ›´æ¼‚äº®
#+begin_src emacs-lisp
(appendq! org-html-checkbox-types
          '((html-span
             (on . "<span class='checkbox'></span>")
             (off . "<span class='checkbox'></span>")
             (trans . "<span class='checkbox'></span>"))))
(setq org-html-checkbox-type 'html-span)
#+end_src
- [ ] I'm yet to do this
- [-] Work in progress
- [X] This is done

**** é¢å¤–çš„ç‰¹æ®Šå­—ç¬¦ä¸²
~org-html-special-string-regexps~ å˜é‡å®šä¹‰äº†ä»¥ä¸‹å†…å®¹çš„æ›¿æ¢ï¼š
+ =\-=, shy è¿å­—ç¬¦
+ =---=, å¢å¼ºçš„ç ´æŠ˜å·
+ =--=, ç ´æŠ˜å·
+ =...=, (æ°´å¹³çš„) çœç•¥å·

ä½†æˆ‘è®¤ä¸ºå¦‚æœè¿˜å¯ä»¥æ›¿æ¢å·¦/å³ç®­å¤´ (=->= å’Œ =<-=) é‚£å°±æ›´å¥½äº†ã€‚ è¿™æ˜¯ä¸€ä¸ª
~defconst~ ï¼Œä½†æ­£å¦‚ä½ å¯ä»¥ä»è¿™ä¸ªé…ç½®ä¸­çš„å¤§é‡å»ºè®®ä¸­çœ‹å‡ºçš„é‚£æ ·ï¼Œæˆ‘å¹¶æ²¡æœ‰æ”¾å¼ƒæˆ‘ä¸ 'åº”
è¯¥' åšçš„äº‹æƒ…ã€‚

å”¯ä¸€çš„å°éº»çƒ¦æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µçš„è¾“å‡ºå¤„ç†ä¹‹å‰ =<= å’Œ =>= è¢«è½¬æ¢ä¸º =&lt;= å’Œ =&gt;= ã€‚
#+begin_src emacs-lisp
(pushnew! org-html-special-string-regexps
          '("-&gt;" . "&#8594;")
          '("&lt;-" . "&#8592;"))
#+end_src

**** æ ‡é¢˜é”šç‚¹
ä¸€ä¸ª GitHub é£æ ¼çš„æ ‡é¢˜é“¾æ¥
#+begin_src emacs-lisp
(defun org-export-html-headline-anchor (text backend info)
  (when (and (org-export-derived-backend-p backend 'html)
             (not (org-export-derived-backend-p backend 're-reveal))
             org-fancy-html-export-mode)
    (unless (bound-and-true-p org-msg-export-in-progress)
      (replace-regexp-in-string
       "<h\\([0-9]\\) id=\"\\([a-z0-9-]+\\)\">\\(.*[^ ]\\)<\\/h[0-9]>" ; this is quite restrictive, but due to `org-reference-contraction' I can do this
       "<h\\1 id=\"\\2\">\\3<a aria-hidden=\"true\" href=\"#\\2\">#</a> </h\\1>"
       text))))

(add-to-list 'org-export-filter-headline-functions
             'org-export-html-headline-anchor)
#+end_src

**** é“¾æ¥é¢„è§ˆ
æœ‰æ—¶è®©é“¾æ¥ç‰¹åˆ«çªå‡ºä¼šå¾ˆå¥½ï¼Œæˆ‘è®¤ä¸ºåƒ Twitter é‚£æ ·çš„åµŒå…¥ / é¢„è§ˆä¼šå¾ˆå¥½ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªä¸ =https= --- =Https= ç•¥æœ‰ä¸åŒçš„æ–°é“¾æ¥ç±»å‹æ¥è½»æ¾åšåˆ°è¿™ç‚¹ã€‚

#+begin_src emacs-lisp
(org-link-set-parameters "Https"
                         :follow (lambda (url arg) (browse-url (concat "https:" url) arg))
                         :export #'org-url-fancy-export)
#+end_src

#+begin_src emacs-lisp
(defun org-url-fancy-export (url _desc backend)
  (let ((metadata (org-url-unfurl-metadata (concat "https:" url))))
    (cond
     ((org-export-derived-backend-p backend 'html)
      (concat
       "<div class=\"link-preview\">"
       (format "<a href=\"%s\">" (concat "https:" url))
       (when (plist-get metadata :image)
         (format "<img src=\"%s\"/>" (plist-get metadata :image)))
       "<small>"
       (replace-regexp-in-string "//\\(?:www\\.\\)?\\([^/]+\\)/?.*" "\\1" url)
       "</small><p>"
       (when (plist-get metadata :title)
         (concat "<b>" (org-html-encode-plain-text (plist-get metadata :title)) "</b></br>"))
       (when (plist-get metadata :description)
         (org-html-encode-plain-text (plist-get metadata :description)))
       "</p></a></div>"))
     (t url))))
#+end_src

ç°åœ¨æˆ‘ä»¬åªéœ€è¦å®ç°å…ƒæ•°æ®æå–åŠŸèƒ½ã€‚
#+begin_src emacs-lisp
(setq! org-url-unfurl-metadata--cache nil)
(defun org-url-unfurl-metadata (url)
  (cdr (or (assoc url org-url-unfurl-metadata--cache)
           (car (push
                 (cons
                  url
                  (let* ((head-data
                          (-filter #'listp
                                   (cdaddr
                                    (with-current-buffer (progn (message "Fetching metadata from %s" url)
                                                                (url-retrieve-synchronously url t t 5))
                                      (goto-char (point-min))
                                      (delete-region (point-min) (- (search-forward "<head") 6))
                                      (delete-region (search-forward "</head>") (point-max))
                                      (goto-char (point-min))
                                      (while (re-search-forward "<script[^\u2800]+?</script>" nil t)
                                        (replace-match ""))
                                      (goto-char (point-min))
                                      (while (re-search-forward "<style[^\u2800]+?</style>" nil t)
                                        (replace-match ""))
                                      (libxml-parse-html-region (point-min) (point-max))))))
                         (meta (delq nil
                                     (mapcar
                                      (lambda (tag)
                                        (when (eq 'meta (car tag))
                                          (cons (or (cdr (assoc 'name (cadr tag)))
                                                    (cdr (assoc 'property (cadr tag))))
                                                (cdr (assoc 'content (cadr tag))))))
                                      head-data))))
                    (let ((title (or (cdr (assoc "og:title" meta))
                                     (cdr (assoc "twitter:title" meta))
                                     (nth 2 (assq 'title head-data))))
                          (description (or (cdr (assoc "og:description" meta))
                                           (cdr (assoc "twitter:description" meta))
                                           (cdr (assoc "description" meta))))
                          (image (or (cdr (assoc "og:image" meta))
                                     (cdr (assoc "twitter:image" meta)))))
                      (when image
                        (setq image (replace-regexp-in-string
                                     "^/" (concat "https://" (replace-regexp-in-string "//\\([^/]+\\)/?.*" "\\1" url) "/")
                                     (replace-regexp-in-string
                                      "^//" "https://"
                                      image))))
                      (list :title title :description description :image image))))
                 org-url-unfurl-metadata--cache)))))
#+end_src

*** Markdown å¯¼å‡º
ç”±äº /[[https://github.com/commonmark/commonmark-spec/wiki/markdown-flavors][Markdown å®ç°çš„å¤šæ ·æ€§]]/ ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰æ ‡å‡†çš„è¡¨æ ¼è§„èŒƒâ€¦â€¦æˆ–æ ‡å‡†çš„ä»»ä½•ä¸œè¥¿ã€‚å› 
ä¸º ~org-md~ è¡¨ç°çš„ä¸ä¼—ä¸åŒï¼Œå®ƒåªæ˜¯å¯¹æ‰€æœ‰è¿™äº›éæ ‡å‡†åŒ–å…ƒç´  (å¾ˆå¤š) ä½¿ç”¨ HTMLã€‚

ä¼¼ä¹å¤§å¤šæ•° Markdown è§£æå™¨éƒ½ä¸“æ³¨äº TeX æ ·å¼çš„è¯­æ³• (=$= å’Œ =$$=)ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä¸ºäº†
è·å¾—è‰¯å¥½çš„æ¸²æŸ“ï¼Œæœ€å¥½å…¼å®¹å®ƒä»¬ã€‚ =ox-md= æ²¡æœ‰ä¸ºæ­¤æä¾›è½¬ç å™¨ï¼Œå› æ­¤å¿…é¡»è‡ªå·±åˆ›å»ºå¹¶å°†
å®ƒä»¬æ¨é€åˆ° =md= è½¬ç å™¨åˆ—è¡¨ä¸­ã€‚

#+begin_src emacs-lisp :noweb-ref none :tangle yes
(after! ox-md
  (defun org-md-latex-fragment (latex-fragment _contents info)
    "Transcode a LATEX-FRAGMENT object from Org to Markdown."
    (let ((frag (org-element-property :value latex-fragment)))
      (cond
       ((string-match-p "^\\\\(" frag)
        (concat "$" (substring frag 2 -2) "$"))
       ((string-match-p "^\\\\\\[" frag)
        (concat "$$" (substring frag 2 -2) "$$"))
       (t (message "unrecognised fragment: %s" frag)
          frag))))

  (defun org-md-latex-environment (latex-environment contents info)
    "Transcode a LATEX-ENVIRONMENT object from Org to Markdown."
    (concat "$$\n"
            (org-html-latex-environment latex-environment contents info)
            "$$\n"))

  (defun org-utf8-entity (entity _contents _info)
    "Transcode an ENTITY object from Org to utf-8.
CONTENTS are the definition itself.  INFO is a plist holding
contextual information."
    (org-element-property :utf-8 entity))

  ;; We can't let this be immediately parsed and evaluated,
  ;; because eager macro-expansion tries to call as-of-yet
  ;; undefined functions.
  ;; NOTE in the near future this shouldn't be required
  (eval
   '(dolist (extra-transcoder
             '((latex-fragment . org-md-latex-fragment)
               (latex-environment . org-md-latex-environment)
               (entity . org-utf8-entity)))
      (unless (member extra-transcoder (org-export-backend-transcoders
                                        (org-export-get-backend 'md)))
        (push extra-transcoder (org-export-backend-transcoders
                                (org-export-get-backend 'md))))))
  (defadvice! org-md-plain-text-unicode-a (orig-fn text info)
    "Locally rebind `org-html-special-string-regexps'"
    :around #'org-md-plain-text
    (let ((org-html-special-string-regexps
           '(("\\\\-" . "-")
             ("---\\([^-]\\|$\\)" . "â€”\\1")
             ("--\\([^-]\\|$\\)" . "â€“\\1")
             ("\\.\\.\\." . "â€¦")
             ("<->" . "âŸ·")
             ("->" . "â†’")
             ("<-" . "â†"))))
      (funcall orig-fn text (plist-put info :with-smart-quotes nil)))))
#+end_src

å½“æˆ‘æƒ³åœ¨æŸå¤„ç²˜è´´å¯¼å‡ºçš„ Markdown æ—¶ï¼Œæœ€å¥½ä½¿ç”¨ unicode å­—ç¬¦ =---= è€Œä¸æ˜¯
=&#x2014;= ã€‚ä¸ºæ­¤ï¼Œåªéœ€è¦åœ¨æœ¬åœ°é‡æ–°ç»‘å®šæä¾›çš„ alistã€‚è€Œ
~org-md-plain-text-unicode-a~ å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚

** dts mode
#+begin_src emacs-lisp :tangle packages.el
(package! dts-mode)
#+end_src

* ç”Ÿæˆ Org æ–‡ä»¶
- agenda
#+begin_src text :tangle (if (file-exists-p "~/org/agenda/todo.org") "no" "~/org/agenda/todo.org") :mkdirp yes
,* Personal
:properties:
:category: personal
:end:

,* Interview
:properties:
:category: interview
:end:

,* Contset
:properties:
:category: contest
:end:

,* Daily
:properties:
:category: daily
:end:

,* Weekly
:properties:
:category: weekly
:end:

,* Monthly
:properties:
:category: monthly
:end:
#+end_src

- project
#+begin_src text :tangle (if (file-exists-p "~/org/agenda/project.org") "no" "~/org/agenda/project.org") :mkdirp yes
#+end_src

- capture
#+begin_src text :tangle (if (file-exists-p "~/org/capture/snippets.org") "no" "~/org/capture/snippets.org") :mkdirp yes
#+end_src

#+begin_src text :tangle (if (file-exists-p "~/org/capture/comments.org") "no" "~/org/capture/comments.org") :mkdirp yes
#+end_src

#+begin_src text :tangle (if (file-exists-p "~/org/capture/notes.org") "no" "~/org/capture/notes.org") :mkdirp yes
#+end_src
